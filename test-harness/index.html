<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red Storm OOB Generator - Test Harness</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            color: #333;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 20px;
        }
        
        .header h1 {
            color: #667eea;
            margin: 0;
            font-size: 2.5em;
        }
        
        .header p {
            color: #666;
            margin: 10px 0 0 0;
            font-size: 1.1em;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9f9f9;
        }
        
        .test-section h3 {
            color: #667eea;
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .test-controls {
            margin: 15px 0;
        }
        
        .test-controls label {
            display: inline-block;
            margin-right: 15px;
            font-weight: bold;
        }
        
        .test-controls select, .test-controls input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
        }
        
        .test-controls button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        .test-controls button:hover {
            background: #5a6fd8;
        }
        
        .test-controls button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .results-area {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .progress-bar {
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            height: 20px;
        }
        
        .progress-fill {
            background: #667eea;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success {
            color: #388e3c;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .warning {
            color: #f57c00;
            background: #fff3e0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .test-details {
            font-size: 11px;
            color: #666;
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Red Storm OOB Generator</h1>
            <p>Comprehensive Test Harness & Validation System</p>
        </div>
        
        <div class="test-section">
            <h3>üéØ Single Test Execution</h3>
            <div class="test-controls">
                <label for="tableSelect">Table:</label>
                <select id="tableSelect">
                    <option value="C">Table C (NATO)</option>
                    <option value="F">Table F (NATO Special)</option>
                    <option value="I">Table I (Warsaw Pact)</option>
                    <option value="L">Table L (Warsaw Pact Special)</option>
                </select>
                
                <label for="missionSelect">Mission:</label>
                <select id="missionSelect">
                    <!-- Dynamically populated based on table selection -->
                </select>
                
                <button onclick="runSingleTest()">Run Single Test</button>
                <button onclick="clearResults()">Clear Results</button>
            </div>
            <div class="results-area" id="singleTestResults">
                Click "Run Single Test" to execute a single test with the selected parameters.
            </div>
        </div>
        
        <div class="test-section">
            <h3>üìä Comprehensive Testing</h3>
            <div class="test-controls">
                <label for="iterationCount">Test Iterations:</label>
                <input type="number" id="iterationCount" value="1000" min="100" max="10000">
                
                <label for="testTable">Test Table:</label>
                <select id="testTable">
                    <option value="all">All Tables</option>
                    <option value="C">Table C Only</option>
                    <option value="F">Table F Only</option>
                    <option value="I">Table I Only</option>
                    <option value="L">Table L Only</option>
                </select>
                
                <button onclick="runComprehensiveTest()" id="comprehensiveBtn">Run Comprehensive Test</button>
                <button onclick="stopTesting()" id="stopBtn" disabled>Stop Testing</button>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">Total Tests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successfulTests">0</div>
                    <div class="stat-label">Successful</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="failedTests">0</div>
                    <div class="stat-label">Failed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="uniqueOutcomes">0</div>
                    <div class="stat-label">Unique Outcomes</div>
                </div>
            </div>
            
            <div class="results-area" id="comprehensiveResults">
                Click "Run Comprehensive Test" to execute statistical validation across all possible outcomes.
            </div>
        </div>
        
        <div class="test-section">
            <h3>üîç Ordnance System Validation</h3>
            <div class="test-controls">
                <button onclick="validateOrdnanceSystems()">Test All Ordnance Systems</button>
                <button onclick="validateModifiers()">Test Ordnance Modifiers</button>
                <button onclick="validateSplitFlights()">Test Split Flights</button>
            </div>
            <div class="results-area" id="ordnanceResults">
                Test ordnance systems, modifiers, and split flight logic.
            </div>
        </div>
        
        <div class="test-section">
            <h3>‚öôÔ∏è System Diagnostics</h3>
            <div class="test-controls">
                <button onclick="runDiagnostics()">Run Full Diagnostics</button>
                <button onclick="validateTableStructure()">Validate Table Structure</button>
                <button onclick="testRandomness()">Test Die Roll Distribution</button>
            </div>
            <div class="results-area" id="diagnosticsResults">
                Run system diagnostics to validate table structures and randomness.
            </div>
        </div>
    </div>

    <script>
        // Global test state
        let testState = {
            running: false,
            stopped: false,
            currentTest: 0,
            totalTests: 0,
            successful: 0,
            failed: 0,
            outcomes: new Set(),
            errors: []
        };

        // Mission type mappings for each table
        const tableMissions = {
            'C': ['bombing', 'sead', 'cap', 'close-escort'],
            'F': ['strategic-bombing', 'naval-strike', 'tactical-recon'],
            'I': ['bombing', 'sead', 'cap', 'close-escort'],
            'L': ['standoff-jamming', 'tactical-recon']
        };

        // Initialize mission select based on table selection
        function updateMissionSelect() {
            const tableSelect = document.getElementById('tableSelect');
            const missionSelect = document.getElementById('missionSelect');
            const selectedTable = tableSelect.value;
            
            missionSelect.innerHTML = '';
            const missions = tableMissions[selectedTable];
            
            missions.forEach(mission => {
                const option = document.createElement('option');
                option.value = mission;
                option.textContent = mission.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
                missionSelect.appendChild(option);
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateMissionSelect();
            document.getElementById('tableSelect').addEventListener('change', updateMissionSelect);
        });

        // Utility function to generate random die roll (1-20)
        function rollD20() {
            return Math.floor(Math.random() * 20) + 1;
        }

        // Mock OOB generator functions for testing
        // These replicate the logic from the main generator for testing purposes
        function mockGenerateOOB(table, missionType) {
            try {
                const roll = rollD20();
                const atafZone = missionType;
                
                let result = {
                    table: table,
                    missionType: missionType,
                    roll: roll,
                    flights: [],
                    ordnance: null,
                    success: true,
                    timestamp: new Date().toISOString()
                };

                // Simulate the OOB generation logic based on table
                if (table === 'C' || table === 'I') {
                    // Standard tables with ordnance systems
                    result.flights = generateMockFlights(table, missionType, roll);
                    result.ordnance = generateMockOrdnance(table, missionType, result.flights);
                } else {
                    // Special mission tables
                    result.flights = generateMockSpecialFlights(table, missionType, roll);
                }

                return result;
            } catch (error) {
                return {
                    table: table,
                    missionType: missionType,
                    success: false,
                    error: error.message,
                    timestamp: new Date().toISOString()
                };
            }
        }

        function generateMockFlights(table, missionType, roll) {
            // Simplified flight generation for testing
            const flights = [];
            let flightCount = 1;
            
            // Determine flight count based on mission type and roll
            if (missionType === 'bombing' || missionType === 'sead') {
                flightCount = roll <= 10 ? 2 : 4;
            } else {
                flightCount = roll <= 15 ? 2 : 4;
            }

            // Generate individual flights
            for (let i = 0; i < flightCount; i++) {
                const aircraftRoll = rollD20();
                let aircraftType = 'F-16C';
                
                // Simplified aircraft selection
                if (table === 'C') {
                    if (aircraftRoll <= 5) aircraftType = 'F-16C';
                    else if (aircraftRoll <= 10) aircraftType = 'A-10A';
                    else if (aircraftRoll <= 15) aircraftType = 'F-4G';
                    else aircraftType = 'Tornado GR1';
                } else if (table === 'I') {
                    if (aircraftRoll <= 5) aircraftType = 'MiG-29A';
                    else if (aircraftRoll <= 10) aircraftType = 'Su-24';
                    else if (aircraftRoll <= 15) aircraftType = 'Su-17M4';
                    else aircraftType = 'MiG-27K';
                }

                flights.push({
                    id: i + 1,
                    aircraftType: aircraftType,
                    roll: aircraftRoll,
                    ordnanceRoll: rollD20()
                });
            }

            return flights;
        }

        function generateMockSpecialFlights(table, missionType, roll) {
            // Simplified special mission flight generation
            const flights = [];
            
            if (table === 'F') {
                // NATO special missions
                if (missionType === 'strategic-bombing') {
                    flights.push({
                        id: 1,
                        aircraftType: 'F-111F',
                        roll: roll,
                        missionSpecific: true
                    });
                } else if (missionType === 'naval-strike') {
                    flights.push({
                        id: 1,
                        aircraftType: 'Tornado GR1',
                        roll: roll,
                        missionSpecific: true
                    });
                } else if (missionType === 'tactical-recon') {
                    flights.push({
                        id: 1,
                        aircraftType: 'RF-4C',
                        roll: roll,
                        missionSpecific: true
                    });
                }
            } else if (table === 'L') {
                // Warsaw Pact special missions
                if (missionType === 'standoff-jamming') {
                    flights.push({
                        id: 1,
                        aircraftType: 'Tu-16PP',
                        roll: roll,
                        missionSpecific: true
                    });
                } else if (missionType === 'tactical-recon') {
                    flights.push({
                        id: 1,
                        aircraftType: 'MiG-25RB',
                        roll: roll,
                        missionSpecific: true
                    });
                }
            }

            return flights;
        }

        function generateMockOrdnance(table, missionType, flights) {
            // Simplified ordnance generation with modifiers
            const ordnance = {
                flights: [],
                cumulative: '',
                modifiers: []
            };

            flights.forEach(flight => {
                let ordnanceText = 'Standard';
                let modifier = 0;

                // Apply modifiers based on aircraft type
                if (table === 'C') {
                    if (flight.aircraftType === 'F-16C' || flight.aircraftType === 'A-10A') {
                        modifier = 2;
                        ordnance.modifiers.push(`${flight.aircraftType} +2`);
                    } else if (flight.aircraftType.includes('Tornado') || flight.aircraftType === 'CF-18') {
                        modifier = 1;
                        ordnance.modifiers.push(`${flight.aircraftType} +1`);
                    }
                } else if (table === 'I') {
                    if (flight.aircraftType === 'Su-24') {
                        modifier = 2;
                        ordnance.modifiers.push(`${flight.aircraftType} +2`);
                    } else if (flight.aircraftType === 'Su-17M4' || flight.aircraftType === 'MiG-27K') {
                        modifier = 1;
                        ordnance.modifiers.push(`${flight.aircraftType} +1`);
                    }
                }

                // Generate ordnance based on modified roll
                const modifiedRoll = flight.ordnanceRoll + modifier;
                if (modifiedRoll <= 5) ordnanceText = 'Iron Bombs';
                else if (modifiedRoll <= 10) ordnanceText = 'Cluster Bombs';
                else if (modifiedRoll <= 15) ordnanceText = 'Precision Munitions';
                else ordnanceText = 'Advanced Precision';

                // Add ARM for SEAD missions
                if (missionType === 'sead') {
                    ordnanceText += ' +ARM';
                }

                ordnance.flights.push({
                    flightId: flight.id,
                    aircraftType: flight.aircraftType,
                    ordnance: ordnanceText,
                    modifier: modifier,
                    originalRoll: flight.ordnanceRoll,
                    modifiedRoll: modifiedRoll
                });
            });

            // Generate cumulative display
            const uniqueOrdnance = [...new Set(ordnance.flights.map(f => f.ordnance))];
            ordnance.cumulative = uniqueOrdnance.join(', ');

            return ordnance;
        }

        // Single test execution
        function runSingleTest() {
            const table = document.getElementById('tableSelect').value;
            const mission = document.getElementById('missionSelect').value;
            const results = document.getElementById('singleTestResults');
            
            results.innerHTML = '<div class="success">Running single test...</div>';
            
            const result = mockGenerateOOB(table, mission);
            
            let output = `<div class="test-details">`;
            output += `Table: ${result.table}\n`;
            output += `Mission: ${result.missionType}\n`;
            output += `Primary Roll: ${result.roll}\n`;
            output += `Timestamp: ${result.timestamp}\n\n`;
            
            if (result.success) {
                output += `SUCCESS - Generated ${result.flights.length} flights:\n\n`;
                
                result.flights.forEach((flight, index) => {
                    output += `Flight ${flight.id}: ${flight.aircraftType}\n`;
                    output += `  Aircraft Roll: ${flight.roll}\n`;
                    if (flight.ordnanceRoll) {
                        output += `  Ordnance Roll: ${flight.ordnanceRoll}\n`;
                    }
                });
                
                if (result.ordnance) {
                    output += `\nOrdnance Summary:\n`;
                    output += `Cumulative: ${result.ordnance.cumulative}\n`;
                    if (result.ordnance.modifiers.length > 0) {
                        output += `Modifiers: ${result.ordnance.modifiers.join(', ')}\n`;
                    }
                    
                    output += `\nDetailed Ordnance:\n`;
                    result.ordnance.flights.forEach(flight => {
                        output += `Flight ${flight.flightId} (${flight.aircraftType}): ${flight.ordnance}`;
                        if (flight.modifier > 0) {
                            output += ` [${flight.originalRoll}+${flight.modifier}=${flight.modifiedRoll}]`;
                        }
                        output += `\n`;
                    });
                }
                
                results.innerHTML = `<div class="success">Test completed successfully!</div><div class="test-details">${output}</div>`;
            } else {
                output += `FAILED: ${result.error}\n`;
                results.innerHTML = `<div class="error">Test failed!</div><div class="test-details">${output}</div>`;
            }
            
            output += `</div>`;
        }

        // Comprehensive testing
        function runComprehensiveTest() {
            const iterations = parseInt(document.getElementById('iterationCount').value);
            const testTable = document.getElementById('testTable').value;
            
            // Reset test state
            testState = {
                running: true,
                stopped: false,
                currentTest: 0,
                totalTests: iterations,
                successful: 0,
                failed: 0,
                outcomes: new Set(),
                errors: []
            };
            
            document.getElementById('comprehensiveBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            
            updateStats();
            
            const results = document.getElementById('comprehensiveResults');
            results.innerHTML = '<div class="success">Starting comprehensive test...</div>';
            
            // Run tests in batches to avoid blocking UI
            runTestBatch(0, iterations, testTable);
        }

        function runTestBatch(startIndex, totalTests, testTable) {
            if (testState.stopped || startIndex >= totalTests) {
                finishComprehensiveTest();
                return;
            }
            
            const batchSize = 50; // Process 50 tests at a time
            const endIndex = Math.min(startIndex + batchSize, totalTests);
            
            for (let i = startIndex; i < endIndex; i++) {
                if (testState.stopped) break;
                
                // Determine which tables/missions to test
                const tables = testTable === 'all' ? ['C', 'F', 'I', 'L'] : [testTable];
                const table = tables[Math.floor(Math.random() * tables.length)];
                const missions = tableMissions[table];
                const mission = missions[Math.floor(Math.random() * missions.length)];
                
                const result = mockGenerateOOB(table, mission);
                
                testState.currentTest++;
                
                if (result.success) {
                    testState.successful++;
                    // Track unique outcomes
                    const outcomeKey = `${result.table}-${result.missionType}-${result.flights.length}`;
                    testState.outcomes.add(outcomeKey);
                } else {
                    testState.failed++;
                    testState.errors.push({
                        test: i + 1,
                        table: table,
                        mission: mission,
                        error: result.error
                    });
                }
            }
            
            updateStats();
            updateProgress();
            
            // Continue with next batch after a short delay
            setTimeout(() => runTestBatch(endIndex, totalTests, testTable), 10);
        }

        function finishComprehensiveTest() {
            testState.running = false;
            document.getElementById('comprehensiveBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            
            const results = document.getElementById('comprehensiveResults');
            let output = '<div class="success">Comprehensive test completed!</div>';
            
            const successRate = ((testState.successful / testState.totalTests) * 100).toFixed(2);
            
            output += `<div class="test-details">`;
            output += `Total Tests: ${testState.totalTests}\n`;
            output += `Successful: ${testState.successful} (${successRate}%)\n`;
            output += `Failed: ${testState.failed}\n`;
            output += `Unique Outcomes: ${testState.outcomes.size}\n\n`;
            
            if (testState.errors.length > 0) {
                output += `Errors encountered:\n`;
                testState.errors.slice(0, 10).forEach(error => {
                    output += `Test ${error.test}: ${error.table}-${error.mission} - ${error.error}\n`;
                });
                
                if (testState.errors.length > 10) {
                    output += `... and ${testState.errors.length - 10} more errors\n`;
                }
            }
            
            output += `</div>`;
            results.innerHTML = output;
        }

        function stopTesting() {
            testState.stopped = true;
            document.getElementById('stopBtn').disabled = true;
        }

        function updateStats() {
            document.getElementById('totalTests').textContent = testState.currentTest;
            document.getElementById('successfulTests').textContent = testState.successful;
            document.getElementById('failedTests').textContent = testState.failed;
            document.getElementById('uniqueOutcomes').textContent = testState.outcomes.size;
        }

        function updateProgress() {
            const progress = (testState.currentTest / testState.totalTests) * 100;
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${progress}%`;
            progressFill.textContent = `${Math.round(progress)}%`;
        }

        // Ordnance system validation
        function validateOrdnanceSystems() {
            const results = document.getElementById('ordnanceResults');
            results.innerHTML = '<div class="success">Testing ordnance systems...</div>';
            
            let output = '<div class="test-details">';
            let allPassed = true;
            
            // Test each table's ordnance system
            const testTables = ['C', 'I'];
            const testMissions = ['bombing', 'sead'];
            
            testTables.forEach(table => {
                testMissions.forEach(mission => {
                    output += `Testing ${table}-${mission} ordnance system:\n`;
                    
                    for (let i = 0; i < 20; i++) {
                        const result = mockGenerateOOB(table, mission);
                        if (result.success && result.ordnance) {
                            const hasOrdnance = result.ordnance.flights.length > 0;
                            const hasCumulative = result.ordnance.cumulative.length > 0;
                            const hasARM = mission === 'sead' ? result.ordnance.cumulative.includes('ARM') : true;
                            
                            if (!hasOrdnance || !hasCumulative || !hasARM) {
                                output += `  FAIL: Missing ordnance components\n`;
                                allPassed = false;
                            }
                        } else {
                            output += `  FAIL: Generation failed\n`;
                            allPassed = false;
                        }
                    }
                    
                    output += `  PASS: Basic ordnance generation\n`;
                });
            });
            
            output += `\nOverall Result: ${allPassed ? 'PASS' : 'FAIL'}\n`;
            output += '</div>';
            
            const statusClass = allPassed ? 'success' : 'error';
            results.innerHTML = `<div class="${statusClass}">Ordnance system test ${allPassed ? 'passed' : 'failed'}!</div>${output}`;
        }

        function validateModifiers() {
            const results = document.getElementById('ordnanceResults');
            results.innerHTML = '<div class="success">Testing ordnance modifiers...</div>';
            
            let output = '<div class="test-details">';
            let allPassed = true;
            
            // Test modifier application
            const modifierTests = [
                { table: 'C', aircraft: 'F-16C', expectedModifier: 2 },
                { table: 'C', aircraft: 'A-10A', expectedModifier: 2 },
                { table: 'C', aircraft: 'Tornado GR1', expectedModifier: 1 },
                { table: 'I', aircraft: 'Su-24', expectedModifier: 2 },
                { table: 'I', aircraft: 'Su-17M4', expectedModifier: 1 },
                { table: 'I', aircraft: 'MiG-27K', expectedModifier: 1 }
            ];
            
            modifierTests.forEach(test => {
                output += `Testing ${test.aircraft} modifier (+${test.expectedModifier}):\n`;
                
                // Create a mock flight with this aircraft type
                const mockFlight = {
                    id: 1,
                    aircraftType: test.aircraft,
                    roll: 10,
                    ordnanceRoll: 10
                };
                
                const ordnance = generateMockOrdnance(test.table, 'bombing', [mockFlight]);
                const flightOrdnance = ordnance.flights[0];
                
                if (flightOrdnance.modifier === test.expectedModifier) {
                    output += `  PASS: Correct modifier applied\n`;
                } else {
                    output += `  FAIL: Expected +${test.expectedModifier}, got +${flightOrdnance.modifier}\n`;
                    allPassed = false;
                }
            });
            
            output += `\nOverall Result: ${allPassed ? 'PASS' : 'FAIL'}\n`;
            output += '</div>';
            
            const statusClass = allPassed ? 'success' : 'error';
            results.innerHTML = `<div class="${statusClass}">Modifier test ${allPassed ? 'passed' : 'failed'}!</div>${output}`;
        }

        function validateSplitFlights() {
            const results = document.getElementById('ordnanceResults');
            results.innerHTML = '<div class="success">Testing split flight logic...</div>';
            
            let output = '<div class="test-details">';
            output += 'Split flight testing would validate:\n';
            output += '- F-4G/F-4E split flight generation\n';
            output += '- F-4G/F-16C split flight generation\n';
            output += '- Individual ordnance rolls per flight\n';
            output += '- Proper aircraft type assignment\n\n';
            output += 'This requires integration with actual generator functions.\n';
            output += '</div>';
            
            results.innerHTML = `<div class="warning">Split flight test requires main generator integration</div>${output}`;
        }

        // System diagnostics
        function runDiagnostics() {
            const results = document.getElementById('diagnosticsResults');
            results.innerHTML = '<div class="success">Running system diagnostics...</div>';
            
            let output = '<div class="test-details">';
            let allPassed = true;
            
            // Test basic functionality
            output += 'Testing basic functionality:\n';
            
            // Test die roll generation
            const rolls = [];
            for (let i = 0; i < 100; i++) {
                rolls.push(rollD20());
            }
            
            const minRoll = Math.min(...rolls);
            const maxRoll = Math.max(...rolls);
            const avgRoll = (rolls.reduce((a, b) => a + b, 0) / rolls.length).toFixed(2);
            
            if (minRoll >= 1 && maxRoll <= 20) {
                output += `  PASS: Die rolls in valid range (${minRoll}-${maxRoll}, avg: ${avgRoll})\n`;
            } else {
                output += `  FAIL: Die rolls out of range (${minRoll}-${maxRoll})\n`;
                allPassed = false;
            }
            
            // Test table/mission combinations
            output += '\nTesting table/mission combinations:\n';
            Object.entries(tableMissions).forEach(([table, missions]) => {
                missions.forEach(mission => {
                    try {
                        const result = mockGenerateOOB(table, mission);
                        if (result.success) {
                            output += `  PASS: ${table}-${mission}\n`;
                        } else {
                            output += `  FAIL: ${table}-${mission} - ${result.error}\n`;
                            allPassed = false;
                        }
                    } catch (error) {
                        output += `  ERROR: ${table}-${mission} - ${error.message}\n`;
                        allPassed = false;
                    }
                });
            });
            
            output += `\nOverall System Health: ${allPassed ? 'GOOD' : 'ISSUES DETECTED'}\n`;
            output += '</div>';
            
            const statusClass = allPassed ? 'success' : 'error';
            results.innerHTML = `<div class="${statusClass}">System diagnostics ${allPassed ? 'passed' : 'found issues'}!</div>${output}`;
        }

        function validateTableStructure() {
            const results = document.getElementById('diagnosticsResults');
            results.innerHTML = '<div class="success">Validating table structure...</div>';
            
            let output = '<div class="test-details">';
            output += 'Table structure validation:\n\n';
            
            Object.entries(tableMissions).forEach(([table, missions]) => {
                output += `Table ${table}:\n`;
                output += `  Missions: ${missions.join(', ')}\n`;
                output += `  Mission Count: ${missions.length}\n`;
                
                // Validate each mission has proper structure
                missions.forEach(mission => {
                    const result = mockGenerateOOB(table, mission);
                    if (result.success) {
                        output += `  ${mission}: ‚úì Valid\n`;
                    } else {
                        output += `  ${mission}: ‚úó Invalid - ${result.error}\n`;
                    }
                });
                
                output += '\n';
            });
            
            output += '</div>';
            
            results.innerHTML = `<div class="success">Table structure validation completed</div>${output}`;
        }

        function testRandomness() {
            const results = document.getElementById('diagnosticsResults');
            results.innerHTML = '<div class="success">Testing die roll distribution...</div>';
            
            const rollCounts = new Array(21).fill(0); // Index 0 unused, 1-20 for die results
            const totalRolls = 10000;
            
            // Generate rolls and count frequency
            for (let i = 0; i < totalRolls; i++) {
                const roll = rollD20();
                rollCounts[roll]++;
            }
            
            let output = '<div class="test-details">';
            output += `Die Roll Distribution (${totalRolls} rolls):\n\n`;
            
            const expectedFreq = totalRolls / 20; // Should be ~500 for each number
            let maxDeviation = 0;
            
            for (let i = 1; i <= 20; i++) {
                const frequency = rollCounts[i];
                const percentage = ((frequency / totalRolls) * 100).toFixed(1);
                const deviation = Math.abs(frequency - expectedFreq);
                const deviationPercent = ((deviation / expectedFreq) * 100).toFixed(1);
                
                maxDeviation = Math.max(maxDeviation, deviation);
                
                output += `  ${i.toString().padStart(2)}: ${frequency.toString().padStart(4)} (${percentage}%) `;
                output += `deviation: ${deviationPercent}%\n`;
            }
            
            const overallDeviation = ((maxDeviation / expectedFreq) * 100).toFixed(1);
            output += `\nMax deviation: ${overallDeviation}%\n`;
            
            if (overallDeviation < 10) {
                output += 'Distribution quality: GOOD\n';
            } else if (overallDeviation < 20) {
                output += 'Distribution quality: ACCEPTABLE\n';
            } else {
                output += 'Distribution quality: POOR\n';
            }
            
            output += '</div>';
            
            const statusClass = overallDeviation < 20 ? 'success' : 'warning';
            results.innerHTML = `<div class="${statusClass}">Randomness test completed</div>${output}`;
        }

        function clearResults() {
            document.getElementById('singleTestResults').innerHTML = 'Click "Run Single Test" to execute a single test with the selected parameters.';
        }
    </script>
</body>
</html>