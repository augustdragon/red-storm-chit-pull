<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Red Storm Order of Battle Generator</title>
  <!-- Updated: Table A implementation with nested roll system -->
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background-color: #2d3d2d;
      color: #f4f4f4;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      padding: 20px;
      background-color: #1a2a1a;
      border-radius: 8px;
      border-bottom: 2px solid #4a5a4a;
    }

    .title {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 18px;
      font-style: italic;
      opacity: 0.8;
    }

    .main-content {
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    .section {
      background-color: #3a4a3a;
      border-radius: 8px;
      padding: 20px;
      border: 1px solid #4a5a4a;
    }

    .section-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #f4f4f4;
      text-align: center;
    }

    .faction-section {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .faction-header {
      font-size: 18px;
      font-weight: bold;
      padding: 10px 15px;
      border-radius: 6px;
      text-align: center;
    }

    .nato-header {
      background-color: #1976d2;
      color: white;
    }

    .warsaw-header {
      background-color: #d32f2f;
      color: white;
    }

    .table-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }

    .table-button {
      padding: 12px 8px;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.1s, opacity 0.2s;
      min-height: 48px;
    }

    .table-button:hover {
      transform: translateY(-1px);
      opacity: 0.9;
    }

    .table-button:active {
      transform: translateY(0);
    }

    .nato-table {
      background-color: #1976d2;
    }

    .nato-table:hover {
      background-color: #1565c0;
    }

    .warsaw-table {
      background-color: #d32f2f;
    }

    .warsaw-table:hover {
      background-color: #b71c1c;
    }

    .roll-input-section {
      display: none;
      margin-top: 20px;
      padding: 20px;
      background-color: #4a5a4a;
      border-radius: 8px;
      text-align: center;
    }

    .roll-input-section.active {
      display: block;
    }

    .selected-table {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .input-group {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .input-group label {
      font-weight: bold;
      white-space: nowrap;
    }

    .input-group input {
      padding: 8px 12px;
      border: 1px solid #6a7a6a;
      border-radius: 4px;
      background-color: #5a6a5a;
      color: #f4f4f4;
      font-size: 16px;
      width: 80px;
      text-align: center;
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .action-button {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: opacity 0.2s;
    }

    .action-button:hover {
      opacity: 0.9;
    }

    .roll-button {
      background-color: #5d6d47;
    }

    .cancel-button {
      background-color: #6a6a6a;
    }

    .results-section {
      background-color: #2a3a2a;
      border: 1px solid #4a5a4a;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .clear-results {
      background-color: #d32f2f;
      padding: 8px 16px;
      font-size: 14px;
    }

    .results-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      background-color: #3a4a3a;
      margin-bottom: 8px;
      border-radius: 6px;
      border-left: 4px solid #5d6d47;
    }

    .result-info {
      flex: 1;
    }

    .result-table {
      font-size: 14px;
      color: #c4c4c4;
      margin-bottom: 4px;
    }

    .result-text {
      font-size: 16px;
      font-weight: bold;
    }

    .result-roll {
      color: #a4a4a4;
      font-size: 14px;
      margin-left: 10px;
    }

    .remove-result {
      background-color: #d32f2f;
      padding: 6px 12px;
      font-size: 12px;
      margin-left: 15px;
    }

    .empty-results {
      text-align: center;
      color: #a4a4a4;
      font-style: italic;
      padding: 30px;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #8db4e2;
      text-decoration: none;
      font-weight: bold;
    }

    .back-link:hover {
      color: #a4c4f2;
    }

    .table-view-content {
      background-color: #4a5a4a;
      border-radius: 6px;
      padding: 15px;
      margin: 10px 0;
    }

    .table-description {
      font-size: 16px;
      font-weight: bold;
      color: #e4e4e4;
      margin-bottom: 15px;
      text-align: center;
      padding: 10px;
      background-color: #5a6a5a;
      border-radius: 6px;
    }

    .nation-section {
      margin-bottom: 15px;
      padding: 12px;
      background-color: #3a4a3a;
      border-radius: 6px;
      border-left: 4px solid #5d6d47;
    }

    .nation-header {
      font-weight: bold;
      color: #f4f4f4;
      margin-bottom: 8px;
      font-size: 16px;
    }

    .aircraft-list {
      margin-left: 15px;
    }

    .aircraft-item {
      color: #d4d4d4;
      margin-bottom: 4px;
      font-family: monospace;
      font-size: 14px;
    }

    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }
      
      .table-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .input-group {
        flex-direction: column;
        gap: 10px;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .results-header {
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">Red Storm</div>
      <div class="subtitle">Order of Battle Generator</div>
    </div>

    <a href="../" class="back-link">‚Üê Back to Red Storm Tools</a>

    <div class="main-content">
      <!-- Table Selection Section -->
      <div class="section" id="tableSelection">
        <div class="section-title">Select Order of Battle Table</div>
        
        <div class="faction-section">
          <div class="faction-header nato-header">NATO Tables</div>
          <div class="table-grid">
            <button class="table-button nato-table" onclick="selectTable('A', 'NATO')">A</button>
            <button class="table-button nato-table" onclick="selectTable('B', 'NATO')">B</button>
            <button class="table-button nato-table" onclick="selectTable('C', 'NATO')">C</button>
            <button class="table-button nato-table" onclick="selectTable('D', 'NATO')">D</button>
            <button class="table-button nato-table" onclick="selectTable('E', 'NATO')">E</button>
            <button class="table-button nato-table" onclick="selectTable('F', 'NATO')">F</button>
          </div>
        </div>

        <div class="faction-section">
          <div class="faction-header warsaw-header">Warsaw Pact Tables</div>
          <div class="table-grid">
            <button class="table-button warsaw-table" onclick="selectTable('G', 'Warsaw Pact')">G</button>
            <button class="table-button warsaw-table" onclick="selectTable('H', 'Warsaw Pact')">H</button>
            <button class="table-button warsaw-table" onclick="selectTable('I', 'Warsaw Pact')">I</button>
            <button class="table-button warsaw-table" onclick="selectTable('J', 'Warsaw Pact')">J</button>
            <button class="table-button warsaw-table" onclick="selectTable('K', 'Warsaw Pact')">K</button>
            <button class="table-button warsaw-table" onclick="selectTable('L', 'Warsaw Pact')">L</button>
          </div>
        </div>
      </div>

      <!-- Roll Input Section -->
      <div class="roll-input-section" id="rollInputSection">
        <div class="selected-table" id="selectedTableDisplay"></div>
        
        <div class="input-group">
          <label for="rollCount">Number of rolls:</label>
          <input type="number" id="rollCount" min="1" max="20" value="1" />
        </div>
        
        <div class="action-buttons">
          <button class="action-button roll-button" onclick="makeRolls()">Make Rolls</button>
          <button class="action-button" style="background-color: #6d5d47;" onclick="viewTable()">View Table</button>
          <button class="action-button cancel-button" onclick="cancelSelection()">Cancel</button>
        </div>
      </div>

      <!-- Table View Section -->
      <div class="section" id="tableViewSection" style="display: none;">
        <div class="section-title" id="tableViewTitle"></div>
        <div id="tableViewContent"></div>
        <div style="text-align: center; margin-top: 20px;">
          <button class="action-button cancel-button" onclick="hideTableView()">Close Table View</button>
        </div>
      </div>

      <!-- Results Section -->
      <div class="section results-section">
        <div class="results-header">
          <div class="section-title">Generated Results</div>
          <button class="action-button clear-results" onclick="clearAllResults()">Clear All</button>
        </div>
        
        <div class="results-list" id="resultsList">
          <div class="empty-results">No results generated yet</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Application state
    let selectedTable = null;
    let selectedFaction = null;
    let results = [];
    let resultCounter = 1;

    // OOB Tables with actual game data
    const oobTables = {
      'A': { 
        name: 'NATO Table A - QRA Flight', 
        faction: 'NATO',
        description: '1 x {2} [QRA], CAP',
        flightSize: 2,
        nations: {
          '1-4': {
            name: 'UK',
            aircraft: {
              '1-6': 'FGR2',
              '7-10': 'Harrier GR3'
            }
          },
          '5-6': {
            name: 'BE/NE',
            aircraft: {
              '1-5': 'F-16A(BE)',
              '6-9': 'F-16A(NE)',
              '10': 'NF-5A'
            }
          },
          '7-10': {
            name: 'FRG',
            aircraft: {
              '1-10': 'F-4F'
            }
          }
        }
      },
      'B': { name: 'NATO Table B', faction: 'NATO', results: {} },
      'C': { name: 'NATO Table C', faction: 'NATO', results: {} },
      'D': { name: 'NATO Table D', faction: 'NATO', results: {} },
      'E': { name: 'NATO Table E', faction: 'NATO', results: {} },
      'F': { name: 'NATO Table F', faction: 'NATO', results: {} },
      'G': { name: 'Warsaw Pact Table G', faction: 'Warsaw Pact', results: {} },
      'H': { name: 'Warsaw Pact Table H', faction: 'Warsaw Pact', results: {} },
      'I': { name: 'Warsaw Pact Table I', faction: 'Warsaw Pact', results: {} },
      'J': { name: 'Warsaw Pact Table J', faction: 'Warsaw Pact', results: {} },
      'K': { name: 'Warsaw Pact Table K', faction: 'Warsaw Pact', results: {} },
      'L': { name: 'Warsaw Pact Table L', faction: 'Warsaw Pact', results: {} }
    };

    function selectTable(tableId, faction) {
      selectedTable = tableId;
      selectedFaction = faction;
      
      const displayText = `${faction} Table ${tableId}`;
      document.getElementById('selectedTableDisplay').textContent = displayText;
      document.getElementById('rollInputSection').classList.add('active');
      document.getElementById('rollCount').focus();
    }

    function cancelSelection() {
      selectedTable = null;
      selectedFaction = null;
      document.getElementById('rollInputSection').classList.remove('active');
      document.getElementById('rollCount').value = 1;
    }

    function makeRolls() {
      if (!selectedTable) return;
      
      const rollCount = parseInt(document.getElementById('rollCount').value);
      if (rollCount < 1 || rollCount > 20) {
        alert('Please enter a number between 1 and 20');
        return;
      }

      const table = oobTables[selectedTable];
      
      for (let i = 0; i < rollCount; i++) {
        const result = getTableResult(selectedTable);
        
        const resultEntry = {
          id: resultCounter++,
          table: selectedTable,
          faction: selectedFaction,
          tableName: table.name,
          nationRoll: result.nationRoll,
          aircraftRoll: result.aircraftRoll,
          result: result.text,
          timestamp: new Date()
        };
        
        results.unshift(resultEntry);
      }
      
      updateResultsDisplay();
      cancelSelection();
    }

    function getTableResult(tableId) {
      const table = oobTables[tableId];
      
      if (tableId === 'A') {
        // Table A: NATO QRA Flight - two-roll system
        const nationRoll = Math.floor(Math.random() * 10) + 1;
        
        // Determine nation based on roll
        let selectedNation, nationName;
        if (nationRoll >= 1 && nationRoll <= 4) {
          selectedNation = table.nations['1-4'];
          nationName = 'UK';
        } else if (nationRoll >= 5 && nationRoll <= 6) {
          selectedNation = table.nations['5-6'];
          nationName = 'BE/NE';
        } else if (nationRoll >= 7 && nationRoll <= 10) {
          selectedNation = table.nations['7-10'];
          nationName = 'FRG';
        }
        
        // Roll for aircraft within that nation
        const aircraftRoll = Math.floor(Math.random() * 10) + 1;
        let aircraftType = null;
        
        // Find matching aircraft based on roll ranges
        for (const [range, aircraft] of Object.entries(selectedNation.aircraft)) {
          const [min, max] = parseRange(range);
          if (aircraftRoll >= min && aircraftRoll <= max) {
            aircraftType = aircraft;
            // Add nation suffix if not already included
            if (!aircraftType.includes('(') && nationName !== 'FRG') {
              aircraftType += `(${nationName})`;
            }
            break;
          }
        }
        
        const resultText = `1 x {${table.flightSize}} ${aircraftType}`;
        
        return {
          nationRoll: nationRoll,
          aircraftRoll: aircraftRoll,
          text: resultText
        };
      }
      
      // Placeholder for other tables
      return {
        nationRoll: null,
        aircraftRoll: null,
        text: `Placeholder result for Table ${tableId}`
      };
    }
    
    function parseRange(range) {
      if (range.includes('-')) {
        const [min, max] = range.split('-').map(num => parseInt(num));
        return [min, max];
      } else {
        const num = parseInt(range);
        return [num, num];
      }
    }

    function updateResultsDisplay() {
      const container = document.getElementById('resultsList');
      
      if (results.length === 0) {
        container.innerHTML = '<div class="empty-results">No results generated yet</div>';
        return;
      }
      
      const resultsHTML = results.map(result => {
        let rollText = '';
        if (result.nationRoll && result.aircraftRoll) {
          rollText = `(nation: ${result.nationRoll}, aircraft: ${result.aircraftRoll})`;
        } else if (result.roll) {
          rollText = `(rolled ${result.roll})`;
        }
        
        return `
          <div class="result-item">
            <div class="result-info">
              <div class="result-table">${result.tableName}</div>
              <div class="result-text">
                ${result.result}
                <span class="result-roll">${rollText}</span>
              </div>
            </div>
            <button class="action-button remove-result" onclick="removeResult(${result.id})">
              Remove
            </button>
          </div>
        `;
      }).join('');
      
      container.innerHTML = resultsHTML;
    }

    function removeResult(resultId) {
      results = results.filter(result => result.id !== resultId);
      updateResultsDisplay();
    }

    function clearAllResults() {
      if (results.length === 0) return;
      
      if (confirm('Are you sure you want to clear all results?')) {
        results = [];
        updateResultsDisplay();
      }
    }

    function viewTable() {
      if (!selectedTable) return;
      
      const table = oobTables[selectedTable];
      const titleElement = document.getElementById('tableViewTitle');
      const contentElement = document.getElementById('tableViewContent');
      
      titleElement.textContent = table.name;
      
      if (selectedTable === 'A') {
        let tableHTML = `<div class="table-view-content">`;
        tableHTML += `<div class="table-description">${table.description}</div>`;
        
        // Show nation roll ranges and aircraft
        for (const [nationRange, nationData] of Object.entries(table.nations)) {
          tableHTML += `<div class="nation-section">`;
          tableHTML += `<div class="nation-header">${nationRange}: ${nationData.name}</div>`;
          tableHTML += `<div class="aircraft-list">`;
          
          for (const [aircraftRange, aircraftType] of Object.entries(nationData.aircraft)) {
            const displayType = aircraftType.includes('(') ? aircraftType : `${aircraftType}(${nationData.name})`;
            if (nationData.name === 'FRG') {
              tableHTML += `<div class="aircraft-item">${aircraftRange}: ${aircraftType}</div>`;
            } else {
              tableHTML += `<div class="aircraft-item">${aircraftRange}: ${displayType}</div>`;
            }
          }
          
          tableHTML += `</div></div>`;
        }
        
        tableHTML += `</div>`;
        contentElement.innerHTML = tableHTML;
      } else {
        contentElement.innerHTML = `<div class="table-view-content">Table data not yet implemented for Table ${selectedTable}</div>`;
      }
      
      document.getElementById('tableViewSection').style.display = 'block';
    }

    function hideTableView() {
      document.getElementById('tableViewSection').style.display = 'none';
    }

    // Initialize the app
    updateResultsDisplay();
  </script>
</body>
</html>