<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Red Storm Initiative Chit Pull</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background-color: #2d3d2d;
      color: #f4f4f4;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      padding: 20px;
      background-color: #1a2a1a;
      border-radius: 8px;
      border-bottom: 2px solid #4a5a4a;
    }

    .title {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 18px;
      font-style: italic;
      opacity: 0.8;
    }

    .main-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
    }

    .fixed-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      min-height: 300px;
      margin-bottom: 40px;
    }

    .result-container {
      margin-bottom: 40px;
    }

    .chit-display {
      width: 120px;
      height: 120px;
      border-radius: 8px;
      border: 3px solid #4a4a4a;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background-color: #f4f4f4;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
      margin-bottom: 20px;
    }

    .placeholder-chit {
      background-color: #e0e0e0;
      border-color: #9e9e9e;
    }

    .small-chit {
      background-color: #f4f4f4;
      border-color: #4a4a4a;
    }

    .large-chit {
      background-color: #f4f4f4;
      border-color: #4a4a4a;
    }

    .chit-value {
      font-size: 48px;
      font-weight: bold;
      margin-bottom: 4px;
    }

    .chit-type {
      font-size: 16px;
      font-weight: bold;
    }

    .small-text {
      color: #d32f2f;
    }

    .large-text {
      color: #1976d2;
    }

    .placeholder-text {
      color: #9e9e9e;
    }

    .button-container {
      display: flex;
      justify-content: space-around;
      width: 100%;
      max-width: 400px;
      gap: 20px;
      margin-bottom: 40px;
    }

    .button {
      padding: 15px 25px;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      min-width: 120px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.25);
      transition: transform 0.1s;
    }

    .button:hover {
      transform: translateY(-1px);
    }

    .button:active {
      transform: translateY(0);
    }

    .small-button {
      background-color: #d32f2f;
    }

    .small-button:hover {
      background-color: #b71c1c;
    }

    .large-button {
      background-color: #1976d2;
    }

    .large-button:hover {
      background-color: #1565c0;
    }

    .scrollable-section {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .top-button-row {
      display: flex;
      justify-content: space-around;
      width: 100%;
      max-width: 600px;
      margin-bottom: 15px;
      gap: 20px;
    }

    .bottom-button-row {
      display: flex;
      justify-content: center;
      width: 100%;
      margin-bottom: 20px;
    }

    .control-button {
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: opacity 0.2s;
    }

    .control-button:hover {
      opacity: 0.8;
    }

    .history-button {
      background-color: #5d6d47;
      flex: 1;
      max-width: 200px;
    }

    .reset-button {
      background-color: #4a4a4a;
      flex: 1;
      max-width: 200px;
    }

    .links-button {
      background-color: #6d5d47;
      min-width: 120px;
    }

    .history-container, .links-container {
      background-color: #3a4a3a;
      border-radius: 8px;
      padding: 15px;
      margin-top: 10px;
      width: 100%;
      max-width: 600px;
    }

    .history-container {
      max-height: 300px;
    }

    .section-title {
      color: #f4f4f4;
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
      text-align: center;
    }

    .empty-history {
      color: #d4d4d4;
      font-style: italic;
      text-align: center;
      margin-top: 20px;
    }

    .history-list {
      max-height: 250px;
      overflow-y: auto;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background-color: #4a5a4a;
      margin-bottom: 5px;
      border-radius: 5px;
    }

    .history-number {
      color: #f4f4f4;
      font-size: 12px;
      font-weight: bold;
      min-width: 30px;
    }

    .history-value {
      font-size: 18px;
      font-weight: bold;
      flex: 1;
      text-align: center;
    }

    .history-type {
      color: #d4d4d4;
      font-size: 12px;
      font-weight: bold;
      min-width: 25px;
      text-align: right;
    }

    .links-container {
      background-color: #3a3a4a;
    }

    .link-item {
      display: block;
      background-color: #4a4a5a;
      color: #f4f4f4;
      padding: 12px 15px;
      margin-bottom: 8px;
      border-radius: 5px;
      text-decoration: none;
      text-align: center;
      transition: background-color 0.2s;
    }

    .link-item:hover {
      background-color: #5a5a6a;
      color: #f4f4f4;
    }

    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }
      
      .button-container {
        flex-direction: column;
        align-items: center;
      }
      
      .top-button-row {
        flex-direction: column;
        gap: 10px;
      }
      
      .title {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">Red Storm</div>
      <div class="subtitle">Initiative Chit Pull</div>
    </div>

    <div class="main-content">
      <div class="fixed-section">
        <div class="result-container">
          <div id="chitDisplay" class="chit-display placeholder-chit">
            <div id="chitValue" class="chit-value placeholder-text">?</div>
            <div id="chitType" class="chit-type" style="display: none;"></div>
          </div>
        </div>

        <div class="button-container">
          <button class="button small-button" onclick="drawChit('small')">
            Draw Small
          </button>
          <button class="button large-button" onclick="drawChit('large')">
            Draw Large
          </button>
        </div>
      </div>

      <div class="scrollable-section">
        <div class="top-button-row">
          <button class="control-button history-button" onclick="toggleHistory()">
            <span id="historyButtonText">Draw History (0)</span>
          </button>
          <button class="control-button reset-button" onclick="clearHistory()">
            Clear History
          </button>
        </div>

        <div class="bottom-button-row">
          <button class="control-button links-button" onclick="toggleLinks()">
            <span id="linksButtonText">Links</span>
          </button>
        </div>

        <div id="historyContainer" class="history-container" style="display: none;">
          <div class="section-title">Draw History (Last 100)</div>
          <div id="historyContent">
            <div class="empty-history">No draws yet</div>
          </div>
        </div>

        <div id="linksContainer" class="links-container" style="display: none;">
          <div class="section-title">Red Storm Resources</div>
          <a href="https://www.gmtgames.com/p-1059-red-storm-2nd-printing.aspx" target="_blank" class="link-item">
            GMT Games - Official Product Page
          </a>
          <a href="https://talk.consimworld.com/WebX/.1ddc7afe/1" target="_blank" class="link-item">
            ConsimWorld Forum Discussion
          </a>
          <a href="https://boardgamegeek.com/boardgame/213497/red-storm-the-air-war-over-central-germany-1987" target="_blank" class="link-item">
            BoardGameGeek Page
          </a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Application state
    let selectedType = null;
    let drawnValue = null;
    let drawHistory = [];
    let showHistory = false;
    let showLinks = false;

    // Chit pools - these never change
    const chitPools = {
      small: [0, 0, 1, 1, 1, 2, 2, 2, 2, 3],
      large: [1, 2, 2, 2, 3, 3, 4, 4, 4, 5]
    };

    function drawChit(type) {
      const chits = chitPools[type];
      
      // Randomly select a chit (with replacement)
      const randomIndex = Math.floor(Math.random() * chits.length);
      const drawnChit = chits[randomIndex];
      
      // Add to draw history (limit to 100 items for performance)
      const historyEntry = {
        id: Date.now(),
        type,
        value: drawnChit
      };
      
      drawHistory.unshift(historyEntry);
      if (drawHistory.length > 100) {
        drawHistory = drawHistory.slice(0, 100);
      }
      
      console.log('Drew chit:', drawnChit, 'type:', type, 'total history length:', drawHistory.length);
      
      drawnValue = drawnChit;
      selectedType = type;
      
      updateChitDisplay();
      updateHistoryButton();
      
      // Always update history content if the history container is visible
      const historyContainer = document.getElementById('historyContainer');
      const isHistoryVisible = historyContainer && historyContainer.style.display !== 'none';
      console.log('History container visible:', isHistoryVisible);
      if (isHistoryVisible) {
        updateHistoryContent();
      }
    }

    function updateChitDisplay() {
      const chitDisplay = document.getElementById('chitDisplay');
      const chitValue = document.getElementById('chitValue');
      const chitType = document.getElementById('chitType');
      
      if (drawnValue !== null) {
        // Show drawn chit
        chitDisplay.className = `chit-display ${selectedType}-chit`;
        chitValue.textContent = drawnValue;
        chitValue.className = `chit-value ${selectedType}-text`;
        chitType.textContent = selectedType === 'small' ? 'SM' : 'LG';
        chitType.className = `chit-type ${selectedType}-text`;
        chitType.style.display = 'block';
      } else {
        // Show placeholder
        chitDisplay.className = 'chit-display placeholder-chit';
        chitValue.textContent = '?';
        chitValue.className = 'chit-value placeholder-text';
        chitType.style.display = 'none';
      }
    }

    function toggleHistory() {
      if (!showHistory) {
        setShowLinks(false); // Close links when opening history
      }
      setShowHistory(!showHistory);
    }

    function toggleLinks() {
      if (!showLinks) {
        setShowHistory(false); // Close history when opening links
      }
      setShowLinks(!showLinks);
    }

    function setShowHistory(show) {
      showHistory = show;
      const container = document.getElementById('historyContainer');
      const buttonText = document.getElementById('historyButtonText');
      
      if (show) {
        container.style.display = 'block';
        buttonText.textContent = `Hide History (${Math.min(drawHistory.length, 100)})`;
        updateHistoryContent();
      } else {
        container.style.display = 'none';
        buttonText.textContent = `Draw History (${Math.min(drawHistory.length, 100)})`;
      }
    }

    function setShowLinks(show) {
      showLinks = show;
      const container = document.getElementById('linksContainer');
      const buttonText = document.getElementById('linksButtonText');
      
      if (show) {
        container.style.display = 'block';
        buttonText.textContent = 'Hide Links';
      } else {
        container.style.display = 'none';
        buttonText.textContent = 'Links';
      }
    }

    function updateHistoryButton() {
      const buttonText = document.getElementById('historyButtonText');
      const count = Math.min(drawHistory.length, 100);
      
      if (showHistory) {
        buttonText.textContent = `Hide History (${count})`;
      } else {
        buttonText.textContent = `Draw History (${count})`;
      }
    }

    function updateHistoryContent() {
      const content = document.getElementById('historyContent');
      console.log('updateHistoryContent called - drawHistory.length:', drawHistory.length);
      
      if (drawHistory.length === 0) {
        content.innerHTML = '<div class="empty-history">No draws yet</div>';
      } else {
        const historyHTML = drawHistory.map((entry, index) => `
          <div class="history-item">
            <div class="history-number">#${drawHistory.length - index}</div>
            <div class="history-value ${entry.type}-text">${entry.value}</div>
            <div class="history-type">${entry.type === 'small' ? 'SM' : 'LG'}</div>
          </div>
        `).join('');
        
        content.innerHTML = `<div class="history-list">${historyHTML}</div>`;
        console.log('Updated history HTML with', drawHistory.length, 'items');
      }
    }

    function clearHistory() {
      const wasShowingHistory = showHistory;
      drawHistory = [];
      drawnValue = null;
      selectedType = null;
      updateChitDisplay();
      updateHistoryButton();
      
      // Update history content if it's currently visible
      if (wasShowingHistory) {
        updateHistoryContent();
      }
    }

    // Initialize the app
    updateChitDisplay();
    updateHistoryButton();
  </script>
</body>
</html>