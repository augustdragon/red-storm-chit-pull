<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red Storm OOB Generator - Test Harness</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            color: #333;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 20px;
        }
        
        .header h1 {
            color: #667eea;
            margin: 0;
            font-size: 2.5em;
        }
        
        .header p {
            color: #666;
            margin: 10px 0 0 0;
            font-size: 1.1em;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f9f9f9;
        }
        
        .test-section h3 {
            color: #667eea;
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .test-controls {
            margin: 15px 0;
        }
        
        .test-controls label {
            display: inline-block;
            margin-right: 15px;
            font-weight: bold;
        }
        
        .test-controls select, .test-controls input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
        }
        
        .test-controls button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        .test-controls button:hover {
            background: #5a6fd8;
        }
        
        .test-controls button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .results-area {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .progress-bar {
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            height: 20px;
        }
        
        .progress-fill {
            background: #667eea;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success {
            color: #388e3c;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .warning {
            color: #f57c00;
            background: #fff3e0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .test-details {
            font-size: 11px;
            color: #666;
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Red Storm OOB Generator</h1>
            <p>Comprehensive Test Harness & Validation System</p>
        </div>
        
        <div class="test-section">
            <h3>üéØ Single Test Execution</h3>
            <div class="test-controls">
                <label for="tableSelect">Table:</label>
                <select id="tableSelect">
                    <option value="A">Table A (NATO QRA)</option>
                    <option value="B">Table B (NATO CAP)</option>
                    <option value="G">Table G (WP QRA)</option>
                    <option value="H">Table H (WP Fighter Sweep)</option>
                    <option value="C">Table C (NATO Bombing)</option>
                    <option value="F">Table F (NATO Special)</option>
                    <option value="I">Table I (WP Bombing)</option>
                    <option value="L">Table L (WP Special)</option>
                </select>
                
                <label for="missionSelect">Mission:</label>
                <select id="missionSelect">
                    <!-- Dynamically populated based on table selection -->
                </select>
                
                <button onclick="runSingleTest()">Run Single Test</button>
                <button onclick="clearResults()">Clear Results</button>
            </div>
            <div class="results-area" id="singleTestResults">
                Click "Run Single Test" to execute a single test with the selected parameters.
            </div>
        </div>
        
        <div class="test-section">
            <h3>üìä Comprehensive Testing</h3>
            <div class="test-controls">
                <label for="iterationCount">Test Iterations:</label>
                <input type="number" id="iterationCount" value="1000" min="100" max="10000">
                
                <label for="testTable">Test Table:</label>
                <select id="testTable">
                    <option value="all">All Tables</option>
                    <option value="A">Table A - NATO QRA</option>
                    <option value="B">Table B - NATO CAP</option>
                    <option value="C">Table C - NATO Bombing</option>
                    <option value="D">Table D - NATO Deep Strike</option>
                    <option value="E">Table E - NATO Rescue</option>
                    <option value="F">Table F - NATO Special</option>
                    <option value="G">Table G - WP QRA</option>
                    <option value="H">Table H - WP Fighter Sweep</option>
                    <option value="I">Table I - WP Bombing</option>
                    <option value="J">Table J - WP Deep Strike</option>
                    <option value="K">Table K - WP Rescue</option>
                    <option value="L">Table L - WP Special</option>
                </select>
                
                <button onclick="runComprehensiveTest()" id="comprehensiveBtn">Run Comprehensive Test</button>
                <button onclick="runOutcomeAnalysis()" id="outcomeBtn">Analyze All Outcomes</button>
                <button onclick="stopTesting()" id="stopBtn" disabled>Stop Testing</button>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">Total Tests</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successfulTests">0</div>
                    <div class="stat-label">Successful</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="failedTests">0</div>
                    <div class="stat-label">Failed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="uniqueOutcomes">0</div>
                    <div class="stat-label">Unique Outcomes</div>
                </div>
            </div>
            
            <div class="results-area" id="comprehensiveResults">
                Click "Run Comprehensive Test" for statistical validation or "Analyze All Outcomes" for detailed frequency analysis.
            </div>
        </div>
        
        <div class="test-section">
            <h3>üîç Ordnance System Validation</h3>
            <div class="test-controls">
                <button onclick="validateOrdnanceSystems()">Test All Ordnance Systems</button>
                <button onclick="validateModifiers()">Test Ordnance Modifiers</button>
                <button onclick="validateSplitFlights()">Test Split Flights</button>
            </div>
            <div class="results-area" id="ordnanceResults">
                Test ordnance systems, modifiers, and split flight logic.
            </div>
        </div>
        
        <div class="test-section">
            <h3>‚öôÔ∏è System Diagnostics</h3>
            <div class="test-controls">
                <button onclick="runDiagnostics()">Run Full Diagnostics</button>
                <button onclick="validateTableStructure()">Validate Table Structure</button>
                <button onclick="testRandomness()">Test Die Roll Distribution</button>
            </div>
            <div class="results-area" id="diagnosticsResults">
                Run system diagnostics to validate table structures and randomness.
            </div>
        </div>
    </div>

    <script>
        // Import actual OOB table data from the generator
        // This ensures 100% accuracy with the actual generator
        const oobTables = {
      'A': { 
        name: 'NATO Table A - QRA Flight', 
        faction: 'NATO',
        description: 'NATO QRA Flight - Quick Reaction Alert flights on standby',
        variants: {
          '2ATAF': {
            'pre': {
              nations: {
                '1-4': {
                  name: 'UK',
                  aircraft: {
                    '1-6': 'FGR2',
                    '7-10': 'Harrier GR3'
                  }
                },
                '5-6': {
                  name: 'BE/NE',
                  aircraft: {
                    '1-5': 'F-16A(BE)',
                    '6-9': 'F-16A(NE)',
                    '10': 'NF-5A'
                  }
                },
                '7-10': {
                  name: 'FRG',
                  aircraft: {
                    '1-10': 'F-4F'
                  }
                }
              }
            },
            'post': {
              nations: {
                '1-6': {
                  name: 'UK',
                  aircraft: {
                    '1-6': 'FGR2',
                    '7-10': 'Harrier GR3'
                  }
                },
                '7': {
                  name: 'BE/NE',
                  aircraft: {
                    '1-5': 'F-16A(BE)',
                    '6-9': 'F-16A(NE)',
                    '10': 'NF-5A'
                  }
                },
                '8-10': {
                  name: 'FRG',
                  aircraft: {
                    '1-10': 'F-4F'
                  }
                }
              }
            }
          },
          '4ATAF': {
            'pre': {
              nations: {
                '1-5': {
                  name: 'US',
                  aircraft: {
                    '1-2': 'F-4D',
                    '3-4': 'F-4E',
                    '5-8': 'F-16A',
                    '9-10': 'F-16C'
                  }
                },
                '6-8': {
                  name: 'FRG',
                  aircraft: {
                    '1-8': 'F-4F',
                    '9-10': 'F-104G'
                  }
                },
                '9-10': {
                  name: 'CAN',
                  aircraft: {
                    '1-8': 'CF-18A',
                    '9-10': 'CF-5A'
                  }
                }
              }
            },
            'post': {
              nations: {
                '1-7': {
                  name: 'US',
                  aircraft: {
                    '1-2': 'F-4D',
                    '3-4': 'F-4E',
                    '5-8': 'F-16A',
                    '9-10': 'F-16C'
                  }
                },
                '8-9': {
                  name: 'FRG',
                  aircraft: {
                    '1-8': 'F-4F',
                    '9-10': 'F-104G'
                  }
                },
                '10': {
                  name: 'CAN',
                  aircraft: {
                    '1-8': 'CF-18A',
                    '9-10': 'CF-5A'
                  }
                }
              }
            }
          }
        }
      },
      'B': {
        name: 'NATO Table B - CAP Flight',
        faction: 'NATO',
        description: 'NATO CAP Flight - Combat Air Patrol',
        zones: {
          '2ATAF': {
            'pre': {
              nations: {
                '1-2': { name: 'US', aircraft: { '1-2': 'F-15A', '3-6': 'F-15C', '7-9': 'F-4E', '10': 'F-4D' } },
                '3-5': { name: 'UK', aircraft: { '1-7': 'FGR2', '8-10': 'Tornado F2A' } },
                '6-7': { name: 'BE/NE', aircraft: { '1-5': 'F-16A(BE)', '6-10': 'F-16A(NE)' } },
                '8-10': { name: 'FRG', aircraft: { '1-10': 'F-4F' } }
              }
            },
            'post': {
              nations: {
                '1-4': { name: 'US', aircraft: { '1-2': 'F-15A', '3-6': 'F-15C', '7-9': 'F-4E', '10': 'F-4D' } },
                '5-6': { name: 'UK', aircraft: { '1-7': 'FGR2', '8-10': 'Tornado F2A' } },
                '7-8': { name: 'BE/NE', aircraft: { '1-5': 'F-16A(BE)', '6-10': 'F-16A(NE)' } },
                '9-10': { name: 'FRG', aircraft: { '1-10': 'F-4F' } }
              }
            }
          },
          '4ATAF': {
            'pre': {
              nations: {
                '1-5': { name: 'US', aircraft: { '1-2': 'F-15A', '3-6': 'F-15C', '7-9': 'F-4E', '10': 'F-4D' } },
                '6-8': { name: 'FRG', aircraft: { '1-9': 'F-4F', '10': 'F-104G' } },
                '9-10': { name: 'CAN', aircraft: { '1-9': 'CF-18A', '10': 'CF-5A' } }
              }
            },
            'post': {
              nations: {
                '1-7': { name: 'US', aircraft: { '1-2': 'F-15A', '3-6': 'F-15C', '7-9': 'F-4E', '10': 'F-4D' } },
                '8-9': { name: 'FRG', aircraft: { '1-9': 'F-4F', '10': 'F-104G' } },
                '10': { name: 'CAN', aircraft: { '1-9': 'CF-18A', '10': 'CF-5A' } }
              }
            }
          }
        }
      },
      'G': {
        name: 'WP Table G - QRA Flights',
        faction: 'WP',
        description: 'WP QRA Flights - Quick Reaction Alert',
        nations: {
          '1-3': { name: 'USSR', aircraft: { '1-2': 'MiG-21bis', '3-4': 'MiG-23M', '5-6': 'MiG-23ML', '7-8': 'MiG-29A', '9-10': 'MiG-25PD/Su-27S' } },
          '4-10': { name: 'GDR', aircraft: { '1-6': 'MiG-21bis', '7-10': 'MiG-23ML' } }
        }
      },
      'H': {
        name: 'WP Table H - Fighter Sweep',
        faction: 'WP',
        description: 'WP Fighter Sweep - Air superiority missions',
        nations: {
          '1-7': { name: 'USSR', aircraft: { '1-2': 'MiG-21bis', '3-4': 'MiG-23M', '5-6': 'MiG-23MLA', '7-9': 'MiG-29A', '10': 'MiG-25PD/Su-27S' } },
          '8-10': { name: 'GDR', aircraft: { '1-5': 'MiG-21bis', '6-10': 'MiG-23ML' } }
        }
      },
      'C': {
        name: 'NATO Table C - Bombing Raid',
        faction: 'NATO',
        description: 'NATO Bombing Raid - CAP, SEAD, and Bombing',
        hasTasking: true,
        hasDate: true,
        taskings: {
          'CAP': {
            'pre': {
              nations: {
                '1-5': { name: 'US', aircraft: { '1-2': 'F-15A', '3-6': 'F-15C', '7-8': 'F-4E', '9': 'F-4D', '10': 'F-16C' } },
                '6': { name: 'UK', aircraft: { '1-7': 'FGR2', '8-10': 'Tornado F2A' } },
                '7-8': { name: 'FRG', aircraft: { '1-10': 'F-4F' } },
                '9': { name: 'BE', aircraft: { '1-5': 'F-16A(BE)', '6-10': 'Mirage 5BA' } },
                '10': { name: 'NE/CAN', aircraft: { '1-5': 'F-16A(NE)', '6-10': 'CF-18A' } }
              }
            },
            'post': {
              nations: {
                '1-6': { name: 'US', aircraft: { '1-2': 'F-15A', '3-6': 'F-15C', '7-8': 'F-4E', '9': 'F-4D', '10': 'F-16C' } },
                '7': { name: 'UK', aircraft: { '1-7': 'FGR2', '8-10': 'Tornado F2A' } },
                '8-9': { name: 'FRG', aircraft: { '1-10': 'F-4F' } },
                '10': { name: 'NE/CAN', aircraft: { '1-5': 'F-16A', '6-10': 'CF-18A' } }
              }
            }
          },
          'SEAD': {
            'pre': {
              nations: {
                '1-4': { name: 'US', aircraft: { '1-3': 'F-4G', '4-8': 'F-4G/F-4E', '9': 'F-4G/F-16C', '10': 'A-7D' } },
                '5-6': { name: 'UK', aircraft: { '1-5': 'Torn GR1', '6-8': 'Harrier GR3', '9-10': 'Jaguar GR1A' } },
                '7-9': { name: 'FRG', aircraft: { '1-5': 'Torn IDS', '6-9': 'F-4F', '8-9': 'Alpha Jet', '10': 'F-104G' } },
                '9': { name: 'BE', aircraft: { '1-5': 'F-16A', '6-10': 'Mirage 5BA' } },
                '10': { name: 'NE/CAN', aircraft: { '1-5': 'F-16A', '6-10': 'CF-18A' } }
              }
            },
            'post': {
              nations: {
                '1-6': { name: 'US', aircraft: { '1-3': 'F-4G', '4-8': 'F-4G/F-4E', '9': 'F-4G/F-16C', '10': 'A-7D' } },
                '7': { name: 'UK', aircraft: { '1-5': 'Torn GR1', '6-8': 'Harrier GR3', '9-10': 'Jaguar GR1A' } },
                '8-9': { name: 'FRG', aircraft: { '1-5': 'Torn IDS', '6-9': 'F-4F', '8-9': 'Alpha Jet', '10': 'F-104G' } },
                '10': { name: 'NE/CAN', aircraft: { '1-5': 'F-16A', '6-10': 'CF-18A' } }
              }
            }
          },
          'Bombing': {
            'pre': {
              nations: {
                '1-4': { name: 'US', aircraft: { '1-2': 'F-16A', '3': 'F-16C', '4-6': 'A-10A', '7': 'A-7D', '8-10': 'F-4¬≤' } },
                '5-6': { name: 'UK', aircraft: { '1-5': 'Torn GR1', '6-9': 'Harrier GR3', '10': 'Jaguar GR1A' } },
                '7-9': { name: 'FRG', aircraft: { '1-4': 'Torn IDS', '5-7': 'F-4F', '8-9': 'Alpha Jet', '10': 'F-104G' } },
                '9': { name: 'BE', aircraft: { '1-5': 'F-16A', '6-10': 'Mirage 5BA' } },
                '10': { name: 'NE/CAN', aircraft: { '1-4': 'F-16A', '5-10': 'CF-18A' } }
              }
            },
            'post': {
              nations: {
                '1-6': { name: 'US', aircraft: { '1-2': 'F-16A', '3': 'F-16C', '4-6': 'A-10A', '7': 'A-7D', '8-10': 'F-4¬≤' } },
                '7': { name: 'UK', aircraft: { '1-5': 'Torn GR1', '6-9': 'Harrier GR3', '10': 'Jaguar GR1A' } },
                '8-9': { name: 'FRG', aircraft: { '1-4': 'Torn IDS', '5-7': 'F-4F', '8-9': 'Alpha Jet', '10': 'F-104G' } },
                '10': { name: 'NE/CAN', aircraft: { '1-4': 'F-16A', '5-10': 'CF-18A' } }
              }
            }
          }
        }
      },
      'D': {
        name: 'NATO Table D - Deep Strike Raid',
        faction: 'NATO',
        description: 'NATO Deep Strike - Escort Jamming, CAP, SEAD, Bombing, Recon',
        hasTasking: true,
        taskings: {
          'Escort Jamming': { nations: { '1-10': { name: 'US', aircraft: { '1-10': 'EF-111A' } } } },
          'CAP': {
            nations: {
              '1-6': { name: 'US', aircraft: { '1-3': 'F-15A', '4-7': 'F-15C', '8-10': 'F-4E' } },
              '7-8': { name: 'UK', aircraft: { '1-10': 'FGR2' } },
              '9-10': { name: 'CAN', aircraft: { '1-10': 'CF-18A' } }
            }
          },
          'SEAD': {
            nations: {
              '1-6': { name: 'US', aircraft: { '1-6': 'F-4G', '7-9': 'F-4G/F-4E', '10': 'F-4G/F-16C' } },
              '7-9': { name: 'UK', aircraft: { '1-8': 'Tornado GR1', '9-10': 'Jaguar GR1A' } },
              '10': { name: 'CAN', aircraft: { '1-10': 'CF-18A' } }
            }
          },
          'Bombing': {
            nations: {
              '1-6': { name: 'US', aircraft: { '1-5': 'F-4E or F-111D/E', '6-10': 'F-111F' } },
              '7-8': { name: 'UK', aircraft: { '1-10': 'Tornado GR1' } },
              '9-10': { name: 'FRG', aircraft: { '1-10': 'Tornado IDS' } }
            }
          },
          'Recon': {
            nations: {
              '1-5': { name: 'US', aircraft: { '1-10': 'RF-4C' } },
              '6-7': { name: 'UK', aircraft: { '1-7': 'Jaguar GR1A', '8-10': 'Tornado GR1A' } },
              '8-9': { name: 'FRG', aircraft: { '1-10': 'RF-4E' } },
              '10': { name: 'BE', aircraft: { '1-10': 'Mirage 5BR' } }
            }
          }
        }
      },
      'E': {
        name: 'NATO Table E - Combat Rescue',
        faction: 'NATO',
        description: 'NATO Combat Rescue - Rescue Support and CSAR',
        hasNationality: true,
        nationalities: {
          'US': {
            flights: [
              { type: 'Rescue Support', aircraft: { '1-6': 'A-10A', '7-10': 'A-7D' } },
              { type: 'CSAR', aircraft: { '1-10': 'H-53' } }
            ]
          },
          'UK': {
            flights: [
              { type: 'Rescue Support', aircraft: { '1-8': 'Harrier GR3', '9-10': 'Jaguar GR1A' } },
              { type: 'CSAR', aircraft: { '1-10': 'Puma' } }
            ]
          },
          'FRG': {
            flights: [
              { type: 'Rescue Support', aircraft: { '1-5': 'Alpha Jet', '6-10': 'F-4F' } },
              { type: 'CSAR', aircraft: { '1-10': 'CH-53' } }
            ]
          }
        }
      },
      'F': {
        name: 'NATO Table F - Special Missions',
        faction: 'NATO',
        description: 'NATO Special Missions - Fast FAC, Standoff Jamming, Tactical Recon',
        hasMissionType: true,
        missionTypes: {
          'Fast FAC': {
            nations: {
              '1-5': { name: 'US', aircraft: { '1-4': 'F-4E', '5-10': 'A-10A' } },
              '6-7': { name: 'UK', aircraft: { '1-4': 'Harrier GR3', '5-10': 'Tornado GR1' } },
              '8-9': { name: 'FRG', aircraft: { '1-5': 'F-4F', '6-10': 'Alpha Jet' } },
              '10': { name: 'BE/NE/CAN', aircraft: { '1-4': 'Mirage 5BA', '5-7': 'F-16A', '8-10': 'CF-18A' } }
            }
          },
          'Standoff Jamming': {
            nations: {
              '1-9': { name: 'US', aircraft: { '1-3': 'EC-130H', '4-10': 'EF-111A' } },
              '10': { name: 'UK/FRG', aircraft: { '1-5': 'Falcon 20F', '6-10': 'HFB 320 Hansa Jet' } }
            }
          },
          'Tactical Recon': {
            nations: {
              '1-3': { name: 'US', aircraft: { '1-10': 'RF-4C' } },
              '4-5': { name: 'UK', aircraft: { '1-7': 'Jaguar GR1A', '8-10': 'Tornado GR1A' } },
              '6-9': { name: 'FRG', aircraft: { '1-10': 'RF-4E' } },
              '10': { name: 'BE/NE', aircraft: { '1-5': 'Mirage 5BR', '6-10': 'F-16A(NE)' } }
            }
          }
        }
      },
      'I': {
        name: 'WP Table I - Bombing Raid',
        faction: 'WP',
        description: 'WP Bombing Raid - Close Escort, SEAD, Bombing',
        hasTasking: true,
        hasNationality: true,
        nationalities: {
          'USSR': {
            taskings: {
              'Close Escort': { aircraft: { '1': 'MiG-21bis', '2': 'MiG-23M', '3-4': 'MiG-23MLA', '5-7': 'MiG-23MLD', '8-10': 'MiG-29A' } },
              'SEAD': { aircraft: { '1-2': 'Su-17M4', '3-4': 'MiG-23¬≤', '5-6': 'Su-24', '7-8': 'MiG-27M', '9-10': 'MiG-27K' } },
              'Bombing': { aircraft: { '1-2': 'Su-17M4', '3-4': 'MiG-23¬≤', '5-6': 'Su-25', '7-8': 'MiG-27M', '9-10': 'MiG-27K' } }
            }
          },
          'GDR': {
            taskings: {
              'Close Escort': { aircraft: { '1-5': 'MiG-21MF', '6': 'MiG-21SPS', '7-9': 'MiG-21bis', '10': 'MiG-23MF/ML' } },
              'SEAD': { aircraft: { '1-4': 'Su-22M4', '5-7': 'MiG-21MF', '8-10': 'MiG-23¬≤' } },
              'Bombing': { aircraft: { '1-4': 'Su-22M4', '5-7': 'MiG-21MF', '8-10': 'MiG-23BN' } }
            }
          }
        }
      },
      'J': {
        name: 'WP Table J - Deep Strike Raid',
        faction: 'WP',
        description: 'WP Deep Strike - Escort Jamming, Chaff, Close Escort, Bombing, Recon',
        hasTasking: true,
        taskings: {
          'Escort Jamming': {
            nations: {
              '1-2': { name: 'USSR', aircraft: { '1-2': 'Su-24MP', '3-5': 'MiG-25RB', '6-8': 'Yak-28PP', '9-10': 'Tu-22PP' } },
              '3-5': { name: 'USSR', aircraft: { '1-5': 'MiG-25RB', '6-10': 'Tu-22PP' } },
              '6-8': { name: 'USSR', aircraft: { '1-4': 'Su-24MP', '5-8': 'MiG-25RB', '9-10': 'Yak-28PP' } },
              '9-10': { name: 'GDR', aircraft: { '1-10': 'MiG-21PF' } }
            }
          },
          'Chaff Laying': {
            nations: {
              '1-5': { name: 'USSR', aircraft: { '1-5': 'MiG-21bis', '6-10': 'MiG-23M' } },
              '6-8': { name: 'USSR', aircraft: { '1-4': 'Yak-28R', '5-8': 'MiG-25RB', '9-10': 'Su-24MR' } },
              '9-10': { name: 'GDR', aircraft: { '1-10': 'MiG-21PF' } }
            }
          },
          'Close Escort': {
            nations: {
              '1-3': { name: 'USSR', aircraft: { '1-3': 'MiG-23MLA', '4-7': 'MiG-23MLD', '8-10': 'Su-27S' } },
              '4-7': { name: 'USSR', aircraft: { '1-4': 'MiG-23ML', '5-7': 'MiG-29A', '8-10': 'Su-27S' } },
              '8-10': { name: 'GDR', aircraft: { '1-10': 'MiG-23ML' } }
            }
          },
          'Deep Bombing': {
            nations: {
              '1-4': { name: 'USSR', aircraft: { '1-4': 'Su-24M', '5-8': 'Su-24M4', '9-10': 'MiG-27K' } },
              '5-8': { name: 'USSR', aircraft: { '1-10': 'Tu-22M' } },
              '9-10': { name: 'GDR', aircraft: { '1-10': 'Su-22M4' } }
            }
          },
          'Recon': {
            nations: {
              '1-5': { name: 'USSR', aircraft: { '1-5': 'Su-17M4R', '6-10': 'MiG-25RB' } },
              '6-7': { name: 'USSR', aircraft: { '1-7': 'Yak-28R', '8-10': 'Su-24MR' } },
              '8-9': { name: 'USSR', aircraft: { '1-5': 'MiG-21R', '6-10': 'MiG-25RB' } },
              '10': { name: 'GDR', aircraft: { '1-10': 'MiG-21R' } }
            }
          }
        }
      },
      'K': {
        name: 'WP Table K - Combat Rescue',
        faction: 'WP',
        description: 'WP Combat Rescue - Rescue Support and CSAR',
        hasNationality: true,
        nationalities: {
          'USSR': {
            flights: [
              { type: 'Rescue Support', aircraft: { '1-5': 'Su-25', '6-8': 'Su-17M4', '9-10': 'MiG-21bis' } },
              { type: 'CSAR', aircraft: { '1-10': 'Mi-8' } }
            ]
          },
          'GDR': {
            flights: [
              { type: 'Rescue Support', aircraft: { '1-5': 'MiG-21bis', '6-10': 'MiG-23BN' } },
              { type: 'CSAR', aircraft: { '1-10': 'Mi-8' } }
            ]
          }
        }
      },
      'L': {
        name: 'WP Table L - Special Missions',
        faction: 'WP',
        description: 'WP Special Missions - Standoff Jamming, Tactical Recon',
        hasMissionType: true,
        missionTypes: {
          'Standoff Jamming': {
            nations: {
              '1-5': { name: 'USSR', aircraft: { '1-5': 'An-12PP', '6-10': 'Tu-16P' } },
              '6-10': { name: 'GDR', aircraft: { '1-10': 'An-26' } }
            }
          },
          'Tactical Recon': {
            hasNationSelection: true,
            nationData: {
              'USSR': { aircraft: { '1-2': 'MiG-21R', '3-4': 'Su-17M3R', '5-7': 'Su-24MR', '8-10': 'MiG-25RB' } },
              'GDR': { aircraft: { '1-5': 'MiG-21R', '6-10': 'Su-22M4R' } }
            }
          }
        }
      }
    };
    
        // Global test state
        let testState = {
            running: false,
            stopped: false,
            currentTest: 0,
            totalTests: 0,
            successful: 0,
            failed: 0,
            outcomes: new Set(),
            errors: []
        };

        // Mission type mappings for each table
        const tableMissions = {
            'A': ['2ATAF-pre', '2ATAF-post', '4ATAF-pre', '4ATAF-post'],
            'B': ['2ATAF-pre', '2ATAF-post', '4ATAF-pre', '4ATAF-post'],
            'C': ['CAP-pre', 'CAP-post', 'SEAD-pre', 'SEAD-post', 'Bombing-pre', 'Bombing-post'],
            'D': ['Escort Jamming', 'CAP', 'SEAD', 'Bombing', 'Recon'],
            'E': ['US', 'UK', 'FRG'],
            'F': ['Fast FAC', 'Standoff Jamming', 'Tactical Recon'],
            'G': ['simple'],
            'H': ['simple'],
            'I': ['USSR-Close Escort', 'USSR-SEAD', 'USSR-Bombing', 'GDR-Close Escort', 'GDR-SEAD', 'GDR-Bombing'],
            'J': ['Escort Jamming', 'Chaff Laying', 'Close Escort', 'Deep Bombing', 'Recon'],
            'K': ['USSR', 'GDR'],
            'L': ['Standoff Jamming', 'Tactical Recon-USSR', 'Tactical Recon-GDR']
        };

        // Initialize mission select based on table selection
        function updateMissionSelect() {
            const tableSelect = document.getElementById('tableSelect');
            const missionSelect = document.getElementById('missionSelect');
            const selectedTable = tableSelect.value;
            
            missionSelect.innerHTML = '';
            const missions = tableMissions[selectedTable];
            
            missions.forEach(mission => {
                const option = document.createElement('option');
                option.value = mission;
                option.textContent = mission.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
                missionSelect.appendChild(option);
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateMissionSelect();
            document.getElementById('tableSelect').addEventListener('change', updateMissionSelect);
        });

        // Utility function to generate random die roll (1-10)
        function rollD10() {
            return Math.floor(Math.random() * 10) + 1;
        }

        // Mock OOB generator functions for testing
        // These replicate the logic from the main generator for testing purposes
        function mockGenerateOOB(table, missionType) {
            try {
                const roll = rollD10();
                
                let result = {
                    table: table,
                    missionType: missionType,
                    roll: roll,
                    flights: [],
                    ordnance: null,
                    success: true,
                    timestamp: new Date().toISOString()
                };

                // Generate flights based on table type
                if (table === 'A') {
                    result.flights = generateTableAFlights(missionType, roll);
                } else if (table === 'C' || table === 'I') {
                    // Standard tables with ordnance systems
                    result.flights = generateMockFlights(table, missionType, roll);
                    result.ordnance = generateMockOrdnance(table, missionType, result.flights);
                } else {
                    // Special mission tables
                    result.flights = generateMockSpecialFlights(table, missionType, roll);
                }

                return result;
            } catch (error) {
                return {
                    table: table,
                    missionType: missionType,
                    success: false,
                    error: error.message,
                    timestamp: new Date().toISOString()
                };
            }
        }

        function generateTableAFlights(missionType, roll) {
            // Table A - NATO Close Air Support with nation and aircraft sub-rolls
            const flights = [];
            
            // Parse mission type (e.g., "2ATAF-pre", "4ATAF-post")
            const [ataf, timeframe] = missionType.split('-');
            
            // Simplified Table A logic - nation selection based on roll
            let nation = '';
            if (ataf === '2ATAF') {
                if (roll <= 3) nation = 'West German';
                else if (roll <= 6) nation = 'British';
                else if (roll <= 8) nation = 'Belgian';
                else nation = 'Dutch';
            } else { // 4ATAF
                if (roll <= 4) nation = 'US';
                else if (roll <= 7) nation = 'West German';
                else nation = 'British';
            }
            
            // Aircraft sub-roll
            const aircraftRoll = rollD10();
            let aircraftType = 'F-16A';
            
            // Simplified aircraft selection based on nation and timeframe
            if (nation === 'US') {
                if (aircraftRoll <= 3) aircraftType = 'A-10A';
                else if (aircraftRoll <= 6) aircraftType = 'F-16A';
                else aircraftType = 'A-7D';
            } else if (nation === 'West German') {
                if (timeframe === 'pre') {
                    if (aircraftRoll <= 4) aircraftType = 'Alpha Jet';
                    else aircraftType = 'F-4F';
                } else {
                    if (aircraftRoll <= 3) aircraftType = 'Alpha Jet';
                    else if (aircraftRoll <= 6) aircraftType = 'F-4F';
                    else aircraftType = 'Tornado IDS';
                }
            } else if (nation === 'British') {
                if (aircraftRoll <= 5) aircraftType = 'Harrier GR3';
                else aircraftType = 'Jaguar GR1';
            } else if (nation === 'Belgian') {
                aircraftType = 'F-16A';
            } else if (nation === 'Dutch') {
                aircraftType = 'F-16A';
            }
            
            flights.push({
                id: 1,
                nation: nation,
                aircraftType: aircraftType,
                roll: roll,
                aircraftRoll: aircraftRoll,
                ataf: ataf,
                timeframe: timeframe
            });
            
            return flights;
        }

        function generateMockFlights(table, missionType, roll) {
            // Simplified flight generation for testing using 1d10
            const flights = [];
            let flightCount = 1;
            
            // Determine flight count based on mission type and roll
            if (missionType === 'bombing' || missionType === 'sead') {
                flightCount = roll <= 5 ? 2 : 4; // Adjusted for 1d10
            } else {
                flightCount = roll <= 7 ? 2 : 4; // Adjusted for 1d10
            }

            // Generate individual flights
            for (let i = 0; i < flightCount; i++) {
                const aircraftRoll = rollD10();
                let aircraftType = 'F-16C';
                
                // Simplified aircraft selection using 1d10
                if (table === 'C') {
                    if (aircraftRoll <= 2) aircraftType = 'F-16C';
                    else if (aircraftRoll <= 4) aircraftType = 'A-10A';
                    else if (aircraftRoll <= 6) aircraftType = 'F-4G';
                    else if (aircraftRoll <= 8) aircraftType = 'Tornado GR1';
                    else aircraftType = 'CF-18';
                } else if (table === 'I') {
                    if (aircraftRoll <= 2) aircraftType = 'MiG-29A';
                    else if (aircraftRoll <= 4) aircraftType = 'Su-24';
                    else if (aircraftRoll <= 6) aircraftType = 'Su-17M4';
                    else if (aircraftRoll <= 8) aircraftType = 'MiG-27K';
                    else aircraftType = 'MiG-23BN';
                }

                flights.push({
                    id: i + 1,
                    aircraftType: aircraftType,
                    roll: aircraftRoll,
                    ordnanceRoll: rollD10()
                });
            }

            return flights;
        }

        function generateMockSpecialFlights(table, missionType, roll) {
            // Simplified special mission flight generation
            const flights = [];
            
            if (table === 'F') {
                // NATO special missions
                if (missionType === 'strategic-bombing') {
                    flights.push({
                        id: 1,
                        aircraftType: 'F-111F',
                        roll: roll,
                        missionSpecific: true
                    });
                } else if (missionType === 'naval-strike') {
                    flights.push({
                        id: 1,
                        aircraftType: 'Tornado GR1',
                        roll: roll,
                        missionSpecific: true
                    });
                } else if (missionType === 'tactical-recon') {
                    flights.push({
                        id: 1,
                        aircraftType: 'RF-4C',
                        roll: roll,
                        missionSpecific: true
                    });
                }
            } else if (table === 'L') {
                // Warsaw Pact special missions
                if (missionType === 'standoff-jamming') {
                    flights.push({
                        id: 1,
                        aircraftType: 'Tu-16PP',
                        roll: roll,
                        missionSpecific: true
                    });
                } else if (missionType === 'tactical-recon') {
                    flights.push({
                        id: 1,
                        aircraftType: 'MiG-25RB',
                        roll: roll,
                        missionSpecific: true
                    });
                }
            }

            return flights;
        }

        function generateMockOrdnance(table, missionType, flights) {
            // Simplified ordnance generation with modifiers using 1d10
            const ordnance = {
                flights: [],
                cumulative: '',
                modifiers: []
            };

            flights.forEach(flight => {
                let ordnanceText = 'Standard';
                let modifier = 0;

                // Apply modifiers based on aircraft type
                if (table === 'C') {
                    if (flight.aircraftType === 'F-16C' || flight.aircraftType === 'A-10A') {
                        modifier = 2;
                        ordnance.modifiers.push(`${flight.aircraftType} +2`);
                    } else if (flight.aircraftType.includes('Tornado') || flight.aircraftType === 'CF-18') {
                        modifier = 1;
                        ordnance.modifiers.push(`${flight.aircraftType} +1`);
                    }
                } else if (table === 'I') {
                    if (flight.aircraftType === 'Su-24') {
                        modifier = 2;
                        ordnance.modifiers.push(`${flight.aircraftType} +2`);
                    } else if (flight.aircraftType === 'Su-17M4' || flight.aircraftType === 'MiG-27K') {
                        modifier = 1;
                        ordnance.modifiers.push(`${flight.aircraftType} +1`);
                    }
                }

                // Generate ordnance based on modified roll (1d10 + modifier)
                const modifiedRoll = flight.ordnanceRoll + modifier;
                if (modifiedRoll <= 3) ordnanceText = 'Iron Bombs';
                else if (modifiedRoll <= 6) ordnanceText = 'Cluster Bombs';
                else if (modifiedRoll <= 9) ordnanceText = 'Precision Munitions';
                else ordnanceText = 'Advanced Precision';

                // Add ARM for SEAD missions
                if (missionType === 'sead') {
                    ordnanceText += ' +ARM';
                }

                ordnance.flights.push({
                    flightId: flight.id,
                    aircraftType: flight.aircraftType,
                    ordnance: ordnanceText,
                    modifier: modifier,
                    originalRoll: flight.ordnanceRoll,
                    modifiedRoll: modifiedRoll
                });
            });

            // Generate cumulative display
            const uniqueOrdnance = [...new Set(ordnance.flights.map(f => f.ordnance))];
            ordnance.cumulative = uniqueOrdnance.join(', ');

            return ordnance;
        }

        // Single test execution
        function runSingleTest() {
            const table = document.getElementById('tableSelect').value;
            const mission = document.getElementById('missionSelect').value;
            const results = document.getElementById('singleTestResults');
            
            results.innerHTML = '<div class="success">Running single test...</div>';
            
            const result = mockGenerateOOB(table, mission);
            
            let output = `<div class="test-details">`;
            output += `Table: ${result.table}\n`;
            output += `Mission: ${result.missionType}\n`;
            output += `Primary Roll: ${result.roll}\n`;
            output += `Timestamp: ${result.timestamp}\n\n`;
            
            if (result.success) {
                output += `SUCCESS - Generated ${result.flights.length} flights:\n\n`;
                
                result.flights.forEach((flight, index) => {
                    output += `Flight ${flight.id}: ${flight.aircraftType}\n`;
                    output += `  Aircraft Roll: ${flight.roll}\n`;
                    if (flight.ordnanceRoll) {
                        output += `  Ordnance Roll: ${flight.ordnanceRoll}\n`;
                    }
                });
                
                if (result.ordnance) {
                    output += `\nOrdnance Summary:\n`;
                    output += `Cumulative: ${result.ordnance.cumulative}\n`;
                    if (result.ordnance.modifiers.length > 0) {
                        output += `Modifiers: ${result.ordnance.modifiers.join(', ')}\n`;
                    }
                    
                    output += `\nDetailed Ordnance:\n`;
                    result.ordnance.flights.forEach(flight => {
                        output += `Flight ${flight.flightId} (${flight.aircraftType}): ${flight.ordnance}`;
                        if (flight.modifier > 0) {
                            output += ` [${flight.originalRoll}+${flight.modifier}=${flight.modifiedRoll}]`;
                        }
                        output += `\n`;
                    });
                }
                
                results.innerHTML = `<div class="success">Test completed successfully!</div><div class="test-details">${output}</div>`;
            } else {
                output += `FAILED: ${result.error}\n`;
                results.innerHTML = `<div class="error">Test failed!</div><div class="test-details">${output}</div>`;
            }
            
            output += `</div>`;
        }

        // Helper function to parse roll ranges
        function parseRange(range) {
            if (typeof range === 'string' && range.includes('-')) {
                const [min, max] = range.split('-').map(num => parseInt(num));
                return [min, max];
            } else {
                const num = parseInt(range);
                return [num, num];
            }
        }
        
        // Helper function to check if a roll falls within a range
        function isInRange(roll, rangeStr) {
            const [min, max] = parseRange(rangeStr);
            return roll >= min && roll <= max;
        }
        
        // Accurate Table A simulation
        function simulateTableA(ataf, timeframe, iterations) {
            const outcomeTracker = {};
            const tableData = oobTables['A'].variants[ataf][timeframe];
            
            for (let i = 0; i < iterations; i++) {
                const nationRoll = rollD10();
                
                // Find matching nation
                for (const [nationRange, nationData] of Object.entries(tableData.nations)) {
                    if (isInRange(nationRoll, nationRange)) {
                        const aircraftRoll = rollD10();
                        
                        // Find matching aircraft
                        for (const [aircraftRange, aircraftType] of Object.entries(nationData.aircraft)) {
                            if (isInRange(aircraftRoll, aircraftRange)) {
                                const key = `${nationData.name} - ${aircraftType}`;
                                outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                                break;
                            }
                        }
                        break;
                    }
                }
            }
            
            return outcomeTracker;
        }
        
        // Accurate Table B simulation (NATO CAP Flight)
        function simulateTableB(ataf, timeframe, iterations) {
            const outcomeTracker = {};
            const tableData = oobTables['B'].zones[ataf][timeframe];
            
            for (let i = 0; i < iterations; i++) {
                const nationRoll = rollD10();
                
                for (const [nationRange, nationData] of Object.entries(tableData.nations)) {
                    if (isInRange(nationRoll, nationRange)) {
                        const aircraftRoll = rollD10();
                        
                        for (const [aircraftRange, aircraftType] of Object.entries(nationData.aircraft)) {
                            if (isInRange(aircraftRoll, aircraftRange)) {
                                const key = `${nationData.name} - ${aircraftType}`;
                                outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                                break;
                            }
                        }
                        break;
                    }
                }
            }
            
            return outcomeTracker;
        }
        
        // Accurate Table G simulation (WP QRA)
        function simulateTableG(iterations) {
            const outcomeTracker = {};
            const tableData = oobTables['G'];
            
            for (let i = 0; i < iterations; i++) {
                const nationRoll = rollD10();
                
                for (const [nationRange, nationData] of Object.entries(tableData.nations)) {
                    if (isInRange(nationRoll, nationRange)) {
                        const aircraftRoll = rollD10();
                        
                        for (const [aircraftRange, aircraftType] of Object.entries(nationData.aircraft)) {
                            if (isInRange(aircraftRoll, aircraftRange)) {
                                const key = `${nationData.name} - ${aircraftType}`;
                                outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                                break;
                            }
                        }
                        break;
                    }
                }
            }
            
            return outcomeTracker;
        }
        
        // Accurate Table H simulation (WP Fighter Sweep)
        function simulateTableH(iterations) {
            const outcomeTracker = {};
            const tableData = oobTables['H'];
            
            for (let i = 0; i < iterations; i++) {
                const nationRoll = rollD10();
                
                for (const [nationRange, nationData] of Object.entries(tableData.nations)) {
                    if (isInRange(nationRoll, nationRange)) {
                        const aircraftRoll = rollD10();
                        
                        for (const [aircraftRange, aircraftType] of Object.entries(nationData.aircraft)) {
                            if (isInRange(aircraftRoll, aircraftRange)) {
                                const key = `${nationData.name} - ${aircraftType}`;
                                outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                                break;
                            }
                        }
                        break;
                    }
                }
            }
            
            return outcomeTracker;
        }
        
        // Accurate Table C simulation (NATO Bombing Raid with taskings)
        function simulateTableC(tasking, timeframe, iterations) {
            const outcomeTracker = {};
            const tableData = oobTables['C'].taskings[tasking][timeframe];
            
            for (let i = 0; i < iterations; i++) {
                const nationRoll = rollD10();
                
                for (const [nationRange, nationData] of Object.entries(tableData.nations)) {
                    if (isInRange(nationRoll, nationRange)) {
                        const aircraftRoll = rollD10();
                        
                        for (const [aircraftRange, aircraftType] of Object.entries(nationData.aircraft)) {
                            if (isInRange(aircraftRoll, aircraftRange)) {
                                const key = `${nationData.name} - ${aircraftType}`;
                                outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                                break;
                            }
                        }
                        break;
                    }
                }
            }
            
            return outcomeTracker;
        }
        
        // Accurate Table D simulation (NATO Deep Strike)
        function simulateTableD(tasking, iterations) {
            const outcomeTracker = {};
            const tableData = oobTables['D'].taskings[tasking];
            
            for (let i = 0; i < iterations; i++) {
                const nationRoll = rollD10();
                
                for (const [nationRange, nationData] of Object.entries(tableData.nations)) {
                    if (isInRange(nationRoll, nationRange)) {
                        const aircraftRoll = rollD10();
                        
                        for (const [aircraftRange, aircraftType] of Object.entries(nationData.aircraft)) {
                            if (isInRange(aircraftRoll, aircraftRange)) {
                                const key = `${nationData.name} - ${aircraftType}`;
                                outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                                break;
                            }
                        }
                        break;
                    }
                }
            }
            
            return outcomeTracker;
        }
        
        // Accurate Table E simulation (NATO Combat Rescue)
        function simulateTableE(nationality, iterations) {
            const outcomeTracker = {};
            const nationalityData = oobTables['E'].nationalities[nationality];
            
            for (let i = 0; i < iterations; i++) {
                nationalityData.flights.forEach(flight => {
                    const aircraftRoll = rollD10();
                    
                    for (const [aircraftRange, aircraftType] of Object.entries(flight.aircraft)) {
                        if (isInRange(aircraftRoll, aircraftRange)) {
                            const key = `${flight.type} - ${aircraftType}`;
                            outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                            break;
                        }
                    }
                });
            }
            
            return outcomeTracker;
        }
        
        // Accurate Table F simulation (NATO Special Missions)
        function simulateTableF(missionType, iterations) {
            const outcomeTracker = {};
            const missionData = oobTables['F'].missionTypes[missionType];
            
            for (let i = 0; i < iterations; i++) {
                const nationRoll = rollD10();
                
                for (const [nationRange, nationData] of Object.entries(missionData.nations)) {
                    if (isInRange(nationRoll, nationRange)) {
                        const aircraftRoll = rollD10();
                        
                        for (const [aircraftRange, aircraftType] of Object.entries(nationData.aircraft)) {
                            if (isInRange(aircraftRoll, aircraftRange)) {
                                const key = `${nationData.name} - ${aircraftType}`;
                                outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                                break;
                            }
                        }
                        break;
                    }
                }
            }
            
            return outcomeTracker;
        }
        
        // Accurate Table I simulation (WP Bombing Raid)
        function simulateTableI(nationality, tasking, iterations) {
            const outcomeTracker = {};
            const taskingData = oobTables['I'].nationalities[nationality].taskings[tasking];
            
            for (let i = 0; i < iterations; i++) {
                const aircraftRoll = rollD10();
                
                for (const [aircraftRange, aircraftType] of Object.entries(taskingData.aircraft)) {
                    if (isInRange(aircraftRoll, aircraftRange)) {
                        const key = aircraftType;
                        outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                        break;
                    }
                }
            }
            
            return outcomeTracker;
        }
        
        // Accurate Table J simulation (WP Deep Strike)
        function simulateTableJ(tasking, iterations) {
            const outcomeTracker = {};
            const tableData = oobTables['J'].taskings[tasking];
            
            for (let i = 0; i < iterations; i++) {
                const nationRoll = rollD10();
                
                for (const [nationRange, nationData] of Object.entries(tableData.nations)) {
                    if (isInRange(nationRoll, nationRange)) {
                        const aircraftRoll = rollD10();
                        
                        for (const [aircraftRange, aircraftType] of Object.entries(nationData.aircraft)) {
                            if (isInRange(aircraftRoll, aircraftRange)) {
                                const key = `${nationData.name} - ${aircraftType}`;
                                outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                                break;
                            }
                        }
                        break;
                    }
                }
            }
            
            return outcomeTracker;
        }
        
        // Accurate Table K simulation (WP Combat Rescue)
        function simulateTableK(nationality, iterations) {
            const outcomeTracker = {};
            const nationalityData = oobTables['K'].nationalities[nationality];
            
            for (let i = 0; i < iterations; i++) {
                nationalityData.flights.forEach(flight => {
                    const aircraftRoll = rollD10();
                    
                    for (const [aircraftRange, aircraftType] of Object.entries(flight.aircraft)) {
                        if (isInRange(aircraftRoll, aircraftRange)) {
                            const key = `${flight.type} - ${aircraftType}`;
                            outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                            break;
                        }
                    }
                });
            }
            
            return outcomeTracker;
        }
        
        // Accurate Table L simulation (WP Special Missions)
        function simulateTableL(missionType, nationality, iterations) {
            const outcomeTracker = {};
            const missionData = oobTables['L'].missionTypes[missionType];
            
            for (let i = 0; i < iterations; i++) {
                if (missionType === 'Tactical Recon') {
                    // Tactical Recon requires nationality selection
                    const nationData = missionData.nationData[nationality];
                    const aircraftRoll = rollD10();
                    
                    for (const [aircraftRange, aircraftType] of Object.entries(nationData.aircraft)) {
                        if (isInRange(aircraftRoll, aircraftRange)) {
                            const key = `${nationality} - ${aircraftType}`;
                            outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                            break;
                        }
                    }
                } else {
                    // Standoff Jamming uses standard nation roll
                    const nationRoll = rollD10();
                    
                    for (const [nationRange, nationData] of Object.entries(missionData.nations)) {
                        if (isInRange(nationRoll, nationRange)) {
                            const aircraftRoll = rollD10();
                            
                            for (const [aircraftRange, aircraftType] of Object.entries(nationData.aircraft)) {
                                if (isInRange(aircraftRoll, aircraftRange)) {
                                    const key = `${nationData.name} - ${aircraftType}`;
                                    outcomeTracker[key] = (outcomeTracker[key] || 0) + 1;
                                    break;
                                }
                            }
                            break;
                        }
                    }
                }
            }
            
            return outcomeTracker;
        }
        
        // Comprehensive outcome analysis using actual table data
        function runOutcomeAnalysis() {
            const testTable = document.getElementById('testTable').value;
            const iterations = parseInt(document.getElementById('iterationCount').value);
            
            document.getElementById('outcomeBtn').disabled = true;
            
            const results = document.getElementById('comprehensiveResults');
            results.innerHTML = '<div class="success">Analyzing all possible outcomes with actual OOB generator logic...</div>';
            
            let output = '<div class="test-details">';
            output += `Running ${iterations} iterations per configuration...\n\n`;
            
            // Helper function to output results
            function outputResults(label, outcomes, expectedCount = null) {
                output += `\n--- ${label} ---\n`;
                const sortedOutcomes = Object.entries(outcomes).sort((a, b) => b[1] - a[1]);
                const totalRolls = sortedOutcomes.reduce((sum, [_, count]) => sum + count, 0);
                
                sortedOutcomes.forEach(([outcome, count]) => {
                    const percentage = ((count / totalRolls) * 100).toFixed(2);
                    const expectedPer100 = (count / iterations * 100).toFixed(1);
                    output += `${outcome.padEnd(35)} | Count: ${count.toString().padStart(5)} | ${percentage.padStart(6)}% | Per 100: ${expectedPer100.padStart(5)}\n`;
                });
                
                output += `\nTotal outcomes: ${totalRolls} from ${iterations} table rolls\n`;
                
                if (expectedCount !== null) {
                    const actualOutcomes = sortedOutcomes.length;
                    if (actualOutcomes === expectedCount) {
                        output += `‚úì All ${expectedCount} possible outcomes generated\n`;
                    } else {
                        output += `‚ö† WARNING: Only ${actualOutcomes} of ${expectedCount} possible outcomes generated\n`;
                    }
                }
            }
            
            // Test Table A
            if (testTable === 'all' || testTable === 'A') {
                output += `${'='.repeat(80)}\n`;
                output += `TABLE A - NATO QRA FLIGHT\n`;
                output += `${'='.repeat(80)}\n\n`;
                
                ['2ATAF', '4ATAF'].forEach(ataf => {
                    ['pre', 'post'].forEach(timeframe => {
                        const label = `${ataf} ${timeframe === 'pre' ? 'Pre-6/1/87' : '6/1/87 or later'}`;
                        const outcomes = simulateTableA(ataf, timeframe, iterations);
                        
                        let expectedCount = 0;
                        Object.values(oobTables['A'].variants[ataf][timeframe].nations).forEach(nation => {
                            expectedCount += Object.keys(nation.aircraft).length;
                        });
                        
                        outputResults(label, outcomes, expectedCount);
                    });
                });
            }
            
            // Test Table B
            if (testTable === 'all' || testTable === 'B') {
                output += `\n${'='.repeat(80)}\n`;
                output += `TABLE B - NATO CAP FLIGHT\n`;
                output += `${'='.repeat(80)}\n\n`;
                
                ['2ATAF', '4ATAF'].forEach(ataf => {
                    ['pre', 'post'].forEach(timeframe => {
                        const label = `${ataf} ${timeframe === 'pre' ? 'Pre-6/1/87' : '6/1/87 or later'}`;
                        const outcomes = simulateTableB(ataf, timeframe, iterations);
                        
                        let expectedCount = 0;
                        Object.values(oobTables['B'].zones[ataf][timeframe].nations).forEach(nation => {
                            expectedCount += Object.keys(nation.aircraft).length;
                        });
                        
                        outputResults(label, outcomes, expectedCount);
                    });
                });
            }
            
            // Test Table C
            if (testTable === 'all' || testTable === 'C') {
                output += `\n${'='.repeat(80)}\n`;
                output += `TABLE C - NATO BOMBING RAID\n`;
                output += `${'='.repeat(80)}\n\n`;
                
                ['CAP', 'SEAD', 'Bombing'].forEach(tasking => {
                    ['pre', 'post'].forEach(timeframe => {
                        const label = `${tasking} - ${timeframe === 'pre' ? 'Pre-6/1/87' : '6/1/87 or later'}`;
                        const outcomes = simulateTableC(tasking, timeframe, iterations);
                        
                        let expectedCount = 0;
                        Object.values(oobTables['C'].taskings[tasking][timeframe].nations).forEach(nation => {
                            expectedCount += Object.keys(nation.aircraft).length;
                        });
                        
                        outputResults(label, outcomes, expectedCount);
                    });
                });
            }
            
            // Test Table D
            if (testTable === 'all' || testTable === 'D') {
                output += `\n${'='.repeat(80)}\n`;
                output += `TABLE D - NATO DEEP STRIKE RAID\n`;
                output += `${'='.repeat(80)}\n\n`;
                
                ['Escort Jamming', 'CAP', 'SEAD', 'Bombing', 'Recon'].forEach(tasking => {
                    const outcomes = simulateTableD(tasking, iterations);
                    
                    let expectedCount = 0;
                    Object.values(oobTables['D'].taskings[tasking].nations).forEach(nation => {
                        expectedCount += Object.keys(nation.aircraft).length;
                    });
                    
                    outputResults(tasking, outcomes, expectedCount);
                });
            }
            
            // Test Table E
            if (testTable === 'all' || testTable === 'E') {
                output += `\n${'='.repeat(80)}\n`;
                output += `TABLE E - NATO COMBAT RESCUE\n`;
                output += `${'='.repeat(80)}\n\n`;
                
                ['US', 'UK', 'FRG'].forEach(nationality => {
                    const outcomes = simulateTableE(nationality, iterations);
                    
                    let expectedCount = 0;
                    oobTables['E'].nationalities[nationality].flights.forEach(flight => {
                        expectedCount += Object.keys(flight.aircraft).length;
                    });
                    
                    outputResults(nationality, outcomes, expectedCount);
                });
            }
            
            // Test Table F
            if (testTable === 'all' || testTable === 'F') {
                output += `\n${'='.repeat(80)}\n`;
                output += `TABLE F - NATO SPECIAL MISSIONS\n`;
                output += `${'='.repeat(80)}\n\n`;
                
                ['Fast FAC', 'Standoff Jamming', 'Tactical Recon'].forEach(missionType => {
                    const outcomes = simulateTableF(missionType, iterations);
                    
                    let expectedCount = 0;
                    Object.values(oobTables['F'].missionTypes[missionType].nations).forEach(nation => {
                        expectedCount += Object.keys(nation.aircraft).length;
                    });
                    
                    outputResults(missionType, outcomes, expectedCount);
                });
            }
            
            // Test Table G
            if (testTable === 'all' || testTable === 'G') {
                output += `\n${'='.repeat(80)}\n`;
                output += `TABLE G - WP QRA FLIGHTS\n`;
                output += `${'='.repeat(80)}\n\n`;
                
                const outcomes = simulateTableG(iterations);
                
                let expectedCount = 0;
                Object.values(oobTables['G'].nations).forEach(nation => {
                    expectedCount += Object.keys(nation.aircraft).length;
                });
                
                outputResults('WP QRA', outcomes, expectedCount);
            }
            
            // Test Table H
            if (testTable === 'all' || testTable === 'H') {
                output += `\n${'='.repeat(80)}\n`;
                output += `TABLE H - WP FIGHTER SWEEP\n`;
                output += `${'='.repeat(80)}\n\n`;
                
                const outcomes = simulateTableH(iterations);
                
                let expectedCount = 0;
                Object.values(oobTables['H'].nations).forEach(nation => {
                    expectedCount += Object.keys(nation.aircraft).length;
                });
                
                outputResults('Fighter Sweep', outcomes, expectedCount);
            }
            
            // Test Table I
            if (testTable === 'all' || testTable === 'I') {
                output += `\n${'='.repeat(80)}\n`;
                output += `TABLE I - WP BOMBING RAID\n`;
                output += `${'='.repeat(80)}\n\n`;
                
                ['USSR', 'GDR'].forEach(nationality => {
                    ['Close Escort', 'SEAD', 'Bombing'].forEach(tasking => {
                        const label = `${nationality} - ${tasking}`;
                        const outcomes = simulateTableI(nationality, tasking, iterations);
                        
                        const expectedCount = Object.keys(oobTables['I'].nationalities[nationality].taskings[tasking].aircraft).length;
                        
                        outputResults(label, outcomes, expectedCount);
                    });
                });
            }
            
            // Test Table J
            if (testTable === 'all' || testTable === 'J') {
                output += `\n${'='.repeat(80)}\n`;
                output += `TABLE J - WP DEEP STRIKE RAID\n`;
                output += `${'='.repeat(80)}\n\n`;
                
                ['Escort Jamming', 'Chaff Laying', 'Close Escort', 'Deep Bombing', 'Recon'].forEach(tasking => {
                    const outcomes = simulateTableJ(tasking, iterations);
                    
                    let expectedCount = 0;
                    Object.values(oobTables['J'].taskings[tasking].nations).forEach(nation => {
                        expectedCount += Object.keys(nation.aircraft).length;
                    });
                    
                    outputResults(tasking, outcomes, expectedCount);
                });
            }
            
            // Test Table K
            if (testTable === 'all' || testTable === 'K') {
                output += `\n${'='.repeat(80)}\n`;
                output += `TABLE K - WP COMBAT RESCUE\n`;
                output += `${'='.repeat(80)}\n\n`;
                
                ['USSR', 'GDR'].forEach(nationality => {
                    const outcomes = simulateTableK(nationality, iterations);
                    
                    let expectedCount = 0;
                    oobTables['K'].nationalities[nationality].flights.forEach(flight => {
                        expectedCount += Object.keys(flight.aircraft).length;
                    });
                    
                    outputResults(nationality, outcomes, expectedCount);
                });
            }
            
            // Test Table L
            if (testTable === 'all' || testTable === 'L') {
                output += `\n${'='.repeat(80)}\n`;
                output += `TABLE L - WP SPECIAL MISSIONS\n`;
                output += `${'='.repeat(80)}\n\n`;
                
                // Standoff Jamming
                const jamOutcomes = simulateTableL('Standoff Jamming', null, iterations);
                let jamExpected = 0;
                Object.values(oobTables['L'].missionTypes['Standoff Jamming'].nations).forEach(nation => {
                    jamExpected += Object.keys(nation.aircraft).length;
                });
                outputResults('Standoff Jamming', jamOutcomes, jamExpected);
                
                // Tactical Recon - USSR
                const ussrReconOutcomes = simulateTableL('Tactical Recon', 'USSR', iterations);
                const ussrReconExpected = Object.keys(oobTables['L'].missionTypes['Tactical Recon'].nationData['USSR'].aircraft).length;
                outputResults('Tactical Recon - USSR', ussrReconOutcomes, ussrReconExpected);
                
                // Tactical Recon - GDR
                const gdrReconOutcomes = simulateTableL('Tactical Recon', 'GDR', iterations);
                const gdrReconExpected = Object.keys(oobTables['L'].missionTypes['Tactical Recon'].nationData['GDR'].aircraft).length;
                outputResults('Tactical Recon - GDR', gdrReconOutcomes, gdrReconExpected);
            }
            
            output += `\n${'='.repeat(80)}\n`;
            output += `ANALYSIS COMPLETE\n`;
            output += `${'='.repeat(80)}\n`;
            
            output += '</div>';
            results.innerHTML = '<div class="success">Outcome frequency analysis completed!</div>' + output;
            document.getElementById('outcomeBtn').disabled = false;
        }

        // Comprehensive testing
        function runComprehensiveTest() {
            const iterations = parseInt(document.getElementById('iterationCount').value);
            const testTable = document.getElementById('testTable').value;
            
            // Reset test state
            testState = {
                running: true,
                stopped: false,
                currentTest: 0,
                totalTests: iterations,
                successful: 0,
                failed: 0,
                outcomes: new Set(),
                errors: []
            };
            
            document.getElementById('comprehensiveBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            
            updateStats();
            
            const results = document.getElementById('comprehensiveResults');
            results.innerHTML = '<div class="success">Starting comprehensive test...</div>';
            
            // Run tests in batches to avoid blocking UI
            runTestBatch(0, iterations, testTable);
        }

        function runTestBatch(startIndex, totalTests, testTable) {
            if (testState.stopped || startIndex >= totalTests) {
                finishComprehensiveTest();
                return;
            }
            
            const batchSize = 50; // Process 50 tests at a time
            const endIndex = Math.min(startIndex + batchSize, totalTests);
            
            for (let i = startIndex; i < endIndex; i++) {
                if (testState.stopped) break;
                
                // Determine which tables/missions to test
                const tables = testTable === 'all' ? ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L'] : [testTable];
                const table = tables[Math.floor(Math.random() * tables.length)];
                const missions = tableMissions[table];
                const mission = missions[Math.floor(Math.random() * missions.length)];
                
                const result = mockGenerateOOB(table, mission);
                
                testState.currentTest++;
                
                if (result.success) {
                    testState.successful++;
                    // Track unique outcomes
                    const outcomeKey = `${result.table}-${result.missionType}-${result.flights.length}`;
                    testState.outcomes.add(outcomeKey);
                } else {
                    testState.failed++;
                    testState.errors.push({
                        test: i + 1,
                        table: table,
                        mission: mission,
                        error: result.error
                    });
                }
            }
            
            updateStats();
            updateProgress();
            
            // Continue with next batch after a short delay
            setTimeout(() => runTestBatch(endIndex, totalTests, testTable), 10);
        }

        function finishComprehensiveTest() {
            testState.running = false;
            document.getElementById('comprehensiveBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            
            const results = document.getElementById('comprehensiveResults');
            let output = '<div class="success">Comprehensive test completed!</div>';
            
            const successRate = ((testState.successful / testState.totalTests) * 100).toFixed(2);
            
            output += `<div class="test-details">`;
            output += `Total Tests: ${testState.totalTests}\n`;
            output += `Successful: ${testState.successful} (${successRate}%)\n`;
            output += `Failed: ${testState.failed}\n`;
            output += `Unique Outcomes: ${testState.outcomes.size}\n\n`;
            
            if (testState.errors.length > 0) {
                output += `Errors encountered:\n`;
                testState.errors.slice(0, 10).forEach(error => {
                    output += `Test ${error.test}: ${error.table}-${error.mission} - ${error.error}\n`;
                });
                
                if (testState.errors.length > 10) {
                    output += `... and ${testState.errors.length - 10} more errors\n`;
                }
            }
            
            output += `</div>`;
            results.innerHTML = output;
        }

        function stopTesting() {
            testState.stopped = true;
            document.getElementById('stopBtn').disabled = true;
        }

        function updateStats() {
            document.getElementById('totalTests').textContent = testState.currentTest;
            document.getElementById('successfulTests').textContent = testState.successful;
            document.getElementById('failedTests').textContent = testState.failed;
            document.getElementById('uniqueOutcomes').textContent = testState.outcomes.size;
        }

        function updateProgress() {
            const progress = (testState.currentTest / testState.totalTests) * 100;
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${progress}%`;
            progressFill.textContent = `${Math.round(progress)}%`;
        }

        // Ordnance system validation
        function validateOrdnanceSystems() {
            const results = document.getElementById('ordnanceResults');
            results.innerHTML = '<div class="success">Testing ordnance systems...</div>';
            
            let output = '<div class="test-details">';
            let allPassed = true;
            
            // Test each table's ordnance system
            const testTables = ['C', 'I'];
            const testMissions = ['bombing', 'sead'];
            
            testTables.forEach(table => {
                testMissions.forEach(mission => {
                    output += `Testing ${table}-${mission} ordnance system:\n`;
                    
                    for (let i = 0; i < 20; i++) {
                        const result = mockGenerateOOB(table, mission);
                        if (result.success && result.ordnance) {
                            const hasOrdnance = result.ordnance.flights.length > 0;
                            const hasCumulative = result.ordnance.cumulative.length > 0;
                            const hasARM = mission === 'sead' ? result.ordnance.cumulative.includes('ARM') : true;
                            
                            if (!hasOrdnance || !hasCumulative || !hasARM) {
                                output += `  FAIL: Missing ordnance components\n`;
                                allPassed = false;
                            }
                        } else {
                            output += `  FAIL: Generation failed\n`;
                            allPassed = false;
                        }
                    }
                    
                    output += `  PASS: Basic ordnance generation\n`;
                });
            });
            
            output += `\nOverall Result: ${allPassed ? 'PASS' : 'FAIL'}\n`;
            output += '</div>';
            
            const statusClass = allPassed ? 'success' : 'error';
            results.innerHTML = `<div class="${statusClass}">Ordnance system test ${allPassed ? 'passed' : 'failed'}!</div>${output}`;
        }

        function validateModifiers() {
            const results = document.getElementById('ordnanceResults');
            results.innerHTML = '<div class="success">Testing ordnance modifiers...</div>';
            
            let output = '<div class="test-details">';
            let allPassed = true;
            
            // Test modifier application
            const modifierTests = [
                { table: 'C', aircraft: 'F-16C', expectedModifier: 2 },
                { table: 'C', aircraft: 'A-10A', expectedModifier: 2 },
                { table: 'C', aircraft: 'Tornado GR1', expectedModifier: 1 },
                { table: 'I', aircraft: 'Su-24', expectedModifier: 2 },
                { table: 'I', aircraft: 'Su-17M4', expectedModifier: 1 },
                { table: 'I', aircraft: 'MiG-27K', expectedModifier: 1 }
            ];
            
            modifierTests.forEach(test => {
                output += `Testing ${test.aircraft} modifier (+${test.expectedModifier}):\n`;
                
                // Create a mock flight with this aircraft type
                const mockFlight = {
                    id: 1,
                    aircraftType: test.aircraft,
                    roll: 10,
                    ordnanceRoll: 10
                };
                
                const ordnance = generateMockOrdnance(test.table, 'bombing', [mockFlight]);
                const flightOrdnance = ordnance.flights[0];
                
                if (flightOrdnance.modifier === test.expectedModifier) {
                    output += `  PASS: Correct modifier applied\n`;
                } else {
                    output += `  FAIL: Expected +${test.expectedModifier}, got +${flightOrdnance.modifier}\n`;
                    allPassed = false;
                }
            });
            
            output += `\nOverall Result: ${allPassed ? 'PASS' : 'FAIL'}\n`;
            output += '</div>';
            
            const statusClass = allPassed ? 'success' : 'error';
            results.innerHTML = `<div class="${statusClass}">Modifier test ${allPassed ? 'passed' : 'failed'}!</div>${output}`;
        }

        function validateSplitFlights() {
            const results = document.getElementById('ordnanceResults');
            results.innerHTML = '<div class="success">Testing split flight logic...</div>';
            
            let output = '<div class="test-details">';
            output += 'Split flight testing would validate:\n';
            output += '- F-4G/F-4E split flight generation\n';
            output += '- F-4G/F-16C split flight generation\n';
            output += '- Individual ordnance rolls per flight\n';
            output += '- Proper aircraft type assignment\n\n';
            output += 'This requires integration with actual generator functions.\n';
            output += '</div>';
            
            results.innerHTML = `<div class="warning">Split flight test requires main generator integration</div>${output}`;
        }

        // System diagnostics
        function runDiagnostics() {
            const results = document.getElementById('diagnosticsResults');
            results.innerHTML = '<div class="success">Running system diagnostics...</div>';
            
            let output = '<div class="test-details">';
            let allPassed = true;
            
            // Test basic functionality
            output += 'Testing basic functionality:\n';
            
            // Test die roll generation
            const rolls = [];
            for (let i = 0; i < 100; i++) {
                rolls.push(rollD10());
            }
            
            const minRoll = Math.min(...rolls);
            const maxRoll = Math.max(...rolls);
            const avgRoll = (rolls.reduce((a, b) => a + b, 0) / rolls.length).toFixed(2);
            
            if (minRoll >= 1 && maxRoll <= 10) {
                output += `  PASS: Die rolls in valid range (${minRoll}-${maxRoll}, avg: ${avgRoll})\n`;
            } else {
                output += `  FAIL: Die rolls out of range (${minRoll}-${maxRoll})\n`;
                allPassed = false;
            }
            
            // Test table/mission combinations
            output += '\nTesting table/mission combinations:\n';
            Object.entries(tableMissions).forEach(([table, missions]) => {
                missions.forEach(mission => {
                    try {
                        const result = mockGenerateOOB(table, mission);
                        if (result.success) {
                            output += `  PASS: ${table}-${mission}\n`;
                        } else {
                            output += `  FAIL: ${table}-${mission} - ${result.error}\n`;
                            allPassed = false;
                        }
                    } catch (error) {
                        output += `  ERROR: ${table}-${mission} - ${error.message}\n`;
                        allPassed = false;
                    }
                });
            });
            
            output += `\nOverall System Health: ${allPassed ? 'GOOD' : 'ISSUES DETECTED'}\n`;
            output += '</div>';
            
            const statusClass = allPassed ? 'success' : 'error';
            results.innerHTML = `<div class="${statusClass}">System diagnostics ${allPassed ? 'passed' : 'found issues'}!</div>${output}`;
        }

        function validateTableStructure() {
            const results = document.getElementById('diagnosticsResults');
            results.innerHTML = '<div class="success">Validating table structure...</div>';
            
            let output = '<div class="test-details">';
            output += 'Table structure validation:\n\n';
            
            Object.entries(tableMissions).forEach(([table, missions]) => {
                output += `Table ${table}:\n`;
                output += `  Missions: ${missions.join(', ')}\n`;
                output += `  Mission Count: ${missions.length}\n`;
                
                // Validate each mission has proper structure
                missions.forEach(mission => {
                    const result = mockGenerateOOB(table, mission);
                    if (result.success) {
                        output += `  ${mission}: ‚úì Valid\n`;
                    } else {
                        output += `  ${mission}: ‚úó Invalid - ${result.error}\n`;
                    }
                });
                
                output += '\n';
            });
            
            output += '</div>';
            
            results.innerHTML = `<div class="success">Table structure validation completed</div>${output}`;
        }

        function testRandomness() {
            const results = document.getElementById('diagnosticsResults');
            results.innerHTML = '<div class="success">Testing die roll distribution...</div>';
            
            const rollCounts = new Array(11).fill(0); // Index 0 unused, 1-10 for die results
            const totalRolls = 10000;
            
            // Generate rolls and count frequency
            for (let i = 0; i < totalRolls; i++) {
                const roll = rollD10();
                rollCounts[roll]++;
            }
            
            let output = '<div class="test-details">';
            output += `Die Roll Distribution - 1d10 (${totalRolls} rolls):\n\n`;
            
            const expectedFreq = totalRolls / 10; // Should be ~1000 for each number
            let maxDeviation = 0;
            
            for (let i = 1; i <= 10; i++) {
                const frequency = rollCounts[i];
                const percentage = ((frequency / totalRolls) * 100).toFixed(1);
                const deviation = Math.abs(frequency - expectedFreq);
                const deviationPercent = ((deviation / expectedFreq) * 100).toFixed(1);
                
                maxDeviation = Math.max(maxDeviation, deviation);
                
                output += `  ${i.toString().padStart(2)}: ${frequency.toString().padStart(4)} (${percentage}%) `;
                output += `deviation: ${deviationPercent}%\n`;
            }
            
            const overallDeviation = ((maxDeviation / expectedFreq) * 100).toFixed(1);
            output += `\nMax deviation: ${overallDeviation}%\n`;
            
            if (overallDeviation < 10) {
                output += 'Distribution quality: GOOD (each result should appear ~10% of the time)\n';
            } else if (overallDeviation < 20) {
                output += 'Distribution quality: ACCEPTABLE\n';
            } else {
                output += 'Distribution quality: POOR\n';
            }
            
            output += '</div>';
            
            const statusClass = overallDeviation < 20 ? 'success' : 'warning';
            results.innerHTML = `<div class="${statusClass}">Randomness test completed</div>${output}`;
        }

        function clearResults() {
            document.getElementById('singleTestResults').innerHTML = 'Click "Run Single Test" to execute a single test with the selected parameters.';
        }
    </script>
</body>
</html>